<!DOCTYPE html>
<html lang="zh-CN">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="/images/favicon.ico">
  <title>深入浅出Windows应用程序开发(二) | 浅梦博客</title>
  <meta name="author" content="浅梦风凌" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="UWP" />
  
  <meta name="description" content="应用数据6.1 应用设置简介1.拥有容器的层次结构2.有本地和漫游两种设置类型Win10支持本地和漫游两种类型,本地是指数据只会存在于当前的客户端应用程序里面,漫游则是指数据会同步到其他设备的相同账户的客户端里.本地应用设置是在根容器ApplicationData.Current.LocalSettings下,而漫游应用设置是在根容器ApplicationData.Current.RoamingS">
<meta property="og:type" content="article">
<meta property="og:title" content="深入浅出Windows应用程序开发(二)">
<meta property="og:url" content="https://drfengyu.github.io/qm/5bdeb856.html">
<meta property="og:site_name" content="浅梦博客">
<meta property="og:description" content="应用数据6.1 应用设置简介1.拥有容器的层次结构2.有本地和漫游两种设置类型Win10支持本地和漫游两种类型,本地是指数据只会存在于当前的客户端应用程序里面,漫游则是指数据会同步到其他设备的相同账户的客户端里.本地应用设置是在根容器ApplicationData.Current.LocalSettings下,而漫游应用设置是在根容器ApplicationData.Current.RoamingS">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://drfengyu.github.io/images/favicon.ico">
<meta property="article:published_time" content="2022-12-05T02:39:37.000Z">
<meta property="article:modified_time" content="2023-11-07T03:10:58.890Z">
<meta property="article:author" content="浅梦风凌">
<meta property="article:tag" content="UWP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://drfengyu.github.io/images/favicon.ico">
<meta name="twitter:site" content="@null">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" type="text/css" media="all">
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-color-dark.min.css" type="text/css" media="(prefers-color-scheme: dark)">
    <script src="/js/kr-dark.min.js"></script>
  
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" type="text/css" media="all">
  
  
  <link rel="stylesheet" id="fontawe-css" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css" type="text/css" media="all">
  <link rel="stylesheet" id="nprogress-css" href="https://unpkg.com/nprogress@0.2.0/nprogress.css" type="text/css" media="all">
  
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>
  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    <script src="https://unpkg.com/qrcode_js@1.0.0/qrcode.min.js"></script>
  
  
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('/images/banner.webp');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('/images/bg.webp');
        }
      }
    
  </style>
  
  <script src="/live2d-widget/autoload.js"></script>
<div style="display: none;">
    <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
    <link rel="stylesheet" type='text/css' href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
</div>

<meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="浅梦博客" type="application/atom+xml">
</head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                        <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                    
                                
                                    
                                        <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                    
                                
                                    
                                        <li><a href="/friends/"><i class="fa fa-paw"></i>好伙伴</a></li>
                                    
                                
                                    
                                        <li>
                                            <a><i class="fa fa-link"></i>链接</a>
                                            <ul class="sub-menu">
                                                
                                                    
                                                
                                                    
                                                        <li><a target="_blank" rel="noopener" href="https://drfengling.github.io/">浅梦博客</a></li>
                                                    
                                                
                                                    
                                                        <li><a target="_blank" rel="noopener" href="https://github.com/Drfengling/Drfengling.github.io">项目链接</a></li>
                                                    
                                                
                                            </ul>
                                        </li>
                                    
                                
                                    
                                        <li>
                                            <a><i class="fa fa-music" aria-hidden="true"></i>歌单</a>
                                            <ul class="sub-menu">
                                                
                                                    
                                                
                                                    
                                                        <li><a href="/playlist/">飙升榜</a></li>
                                                    
                                                
                                            </ul>
                                        </li>
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">浅梦博客</a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>浅梦博客</h2> <br />
                        <span></span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        

            <section class="col-md-8">

        

            <article>
    
    <div class="kratos-hentry kratos-post-inner clearfix">
        <header class="kratos-entry-header">
            
                <h1 class="kratos-entry-title text-center">深入浅出Windows应用程序开发(二)</h1>
            
            
            <ul class="kratos-post-meta text-center">
                <li><i class="fa fa-calendar"></i> 2022-12-05</li>
                <li><i class="fa fa-user"></i> 作者 浅梦风凌</li>
                <li>
                    <i class="fa fa-edit"></i> 
                    
                    
                        ~98.29K
                    
                    字
                </li>
                
            </ul>
        </header>
        <div class="kratos-post-content">
            <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                <div class="icon"><i class="fa fa-warning"></i></div>
                <div class="text"><p>本文最后编辑于 <time datetime="1699326658890"></time> 前，其中的内容可能需要更新。</p></div>
            </div>
            
                <div class="kratos-post-inner-toc">
                    <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">1.</span> <span class="toc-text">应用数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%9B%BE"><span class="toc-number">2.</span> <span class="toc-text">图形绘图</span></a></li></ol>
                </div>
            
            <hr />
            <h4 id="应用数据"><a href="#应用数据" class="headerlink" title="应用数据"></a>应用数据</h4><p>6.1 应用设置简介<br>1.拥有容器的层次结构<br>2.有本地和漫游两种设置类型<br>Win10支持本地和漫游两种类型,本地是指数据只会存在于当前的客户端应用程序里面,漫游则是指数据会同步到其他设备的相同账户的客户端里.本地应用设置是在根容器ApplicationData.Current.LocalSettings下,而漫游应用设置是在根容器ApplicationData.Current.RoamingSetting下,只是存储的根目录不一样,其他Api操作完全一致.<br>3.应用设置支持大多数Windows运行时数据类型<br>应用设置所存储的数据是单个的数据类型对象,它并不是所有的类型都会支持,例如,集合对象不支持,如果要将List<String>对象存储到应用设置里会引起异常信息.<br>数值类型:UInt8-64 Int16-64 Single Double<br>布尔类型:Boolean<br>字符类型:Char16,String<br>时间类型:DateTime,TimeSpan<br>结构类型:GUID,Point,Size,Rect<br>组合类型:ApplicationDataCompositeValue<br>对于不支持的类型,使用应用文件存储,另一种是将数据序列化为一种受支持的数据类型<br>6.1.2.应用设置操作<br>应用设置操作支持增删改查,在开始对应用设置操作之前,首先要获取到应用设置的容器对象(ApplicationDataContainer),所有的操作都会从一个容器对象开始.获取应用程序的根容器可以通过ApplicationData.Current属性来获取单例对象<br>1.添加和修改应用设置<br>在进行应用设置相关操作前,需要先获取应用的设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationDataContainer localSettings=Windows.Storage.ApplicationData.Current.LocalSettings;</span><br></pre></td></tr></table></figure>
<p>获取容器之后,将数据添加到应用设置,如果该应用设置已存在,则对其进行修改,使用ApplicationDataContainer.Values属性可以访问在上一步中获取的LocalSettings容器中的设置,然后通过键/值对方式来操作应用设置.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localSettings.Values[<span class="string">&quot;testSetting&quot;</span>]=<span class="string">&quot;Hello Windows10&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>如果容器里面没有”testSetting”这个键则新增一个,如果已有,则对其进行修改.<br>使用ApplicationDataContainer.Values属性可以访问在上一步中获取的LocalSetting容器中的设置,然后通过键/值对的方式来操作应用设置.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bool isoKeyExist=localSettings.Values.ContainKey(<span class="string">&quot;testSetting&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>2.读取应用设置<br>从设置中读取数据,也是使用ApplicationDataContainer.Values属性来获取应用设置的值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String value=localSettings.Values[<span class="string">&quot;testSetting&quot;</span>].ToString();</span><br></pre></td></tr></table></figure>
<p>3.删除应用设置<br>如果需要删除应用程序里面的设置数据,可以用ApplicationDataContainerSettings.Remove方法来实现.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localSettings.Values.Remove(<span class="string">&quot;testSetting&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;ApplicationDataContainerSettings&quot;</span>&gt;</span><br><span class="line">                &lt;StackPanel&gt;</span><br><span class="line">                    &lt;!--输入应用设置的键--&gt;</span><br><span class="line">                    &lt;StackPanel Orientation=<span class="string">&quot;Horizontal&quot;</span>&gt;</span><br><span class="line">                        &lt;TextBlock x:Name=<span class="string">&quot;textBlock2&quot;</span> Text=<span class="string">&quot;Key:&quot;</span> Width=<span class="string">&quot;150&quot;</span>/&gt;</span><br><span class="line">                        &lt;TextBox x:Name=<span class="string">&quot;txtKey&quot;</span> Text=<span class="string">&quot;&quot;</span> Width=<span class="string">&quot;200&quot;</span>/&gt;</span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;!--输入应用设置的值--&gt;</span><br><span class="line">                    &lt;StackPanel Orientation=<span class="string">&quot;Horizontal&quot;</span> Margin=<span class="string">&quot;0 20 0 0&quot;</span>&gt;</span><br><span class="line">                        &lt;TextBlock Text=<span class="string">&quot;Value:&quot;</span> Width=<span class="string">&quot;150&quot;</span>/&gt;</span><br><span class="line">                        &lt;TextBox x:Name=<span class="string">&quot;txtValue&quot;</span> Text=<span class="string">&quot;&quot;</span> Width=<span class="string">&quot;200&quot;</span>/&gt;</span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;Button Content=<span class="string">&quot;保存&quot;</span> x:Name=<span class="string">&quot;btnSave&quot;</span> Click=<span class="string">&quot;btnSave_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;Button Content=<span class="string">&quot;删除&quot;</span> x:Name=<span class="string">&quot;btnDelete&quot;</span></span><br><span class="line">                            Click=<span class="string">&quot;btnDelete_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;Button Content=<span class="string">&quot;清空所有&quot;</span> x:Name=<span class="string">&quot;deleteall&quot;</span></span><br><span class="line">                            Click=<span class="string">&quot;deleteall_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;!--显示容器内所有的键的列表,点击选中可以在上面的输入框里面查看和修改它对应的值--&gt;</span><br><span class="line">                    &lt;TextBlock Text=<span class="string">&quot;Keys列表:&quot;</span>/&gt;</span><br><span class="line">                    &lt;ListBox Height=<span class="string">&quot;168&quot;</span> x:Name=<span class="string">&quot;lstKeys&quot;</span> SelectionChanged=<span class="string">&quot;lstKeys_SelectionChanged&quot;</span>/&gt;</span><br><span class="line">                    </span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">              </span><br><span class="line">                </span><br><span class="line">            &lt;/PivotItem&gt;</span><br><span class="line"></span><br><span class="line"> ///获取当前应用程序的本地设置根容器</span><br><span class="line">            _appSettings = ApplicationData.Current.LocalSettings;</span><br><span class="line">            //把容器的键列表绑定到list控件</span><br><span class="line">            BindKeyList();</span><br><span class="line"> /// &lt;summary&gt;</span><br><span class="line">        /// 将当前程序中所有的key值绑定到List上</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private void <span class="function"><span class="title">BindKeyList</span></span>()</span><br><span class="line">        &#123;</span><br><span class="line">            //先清空List控件的绑定值</span><br><span class="line">            lstKeys.Items.Clear();</span><br><span class="line">            //获取当前应用程序的所有Key</span><br><span class="line">            foreach (var item <span class="keyword">in</span> _appSettings.Values.Keys)</span><br><span class="line">            &#123;</span><br><span class="line">                //添加到List控件上</span><br><span class="line">                lstKeys.Items.Add(item);</span><br><span class="line">            &#125;</span><br><span class="line">            txtKey.Text = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            txtValue.Text = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //声明容器实例</span><br><span class="line">        private ApplicationDataContainer _appSettings;</span><br><span class="line"> /// &lt;summary&gt;</span><br><span class="line">        /// 保存应用设置的值</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void btnSave_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            //检查key输入框不为空</span><br><span class="line">            <span class="keyword">if</span> (!string.IsNullOrEmpty(txtKey.Text))</span><br><span class="line">            &#123;</span><br><span class="line">                _appSettings.Values[txtKey.Text] = txtValue.Text;</span><br><span class="line">                BindKeyList();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;请输入key值&quot;</span>).ShowAsync();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 删除在List中选中的应用设置</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private void btnDelete_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            //如果选中了List中的某项</span><br><span class="line">            <span class="keyword">if</span> (lstKeys.SelectedIndex &gt; -1)</span><br><span class="line">            &#123;</span><br><span class="line">                //移除这个键的独立存储设置</span><br><span class="line">                _appSettings.Values.Remove(lstKeys.SelectedItem.ToString());</span><br><span class="line">                BindKeyList();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 清空容器所有的设置</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private void deleteall_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            _appSettings.Values.Clear();</span><br><span class="line">            BindKeyList();</span><br><span class="line">        &#125;</span><br><span class="line">        //List控件选中项的事件,将选中的键和值显示在上面的文本框中.</span><br><span class="line">        private void lstKeys_SelectionChanged(object sender, SelectionChangedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (e.AddedItems.Count &gt; 0)</span><br><span class="line">            &#123;</span><br><span class="line">                //获取在List中选择的Key</span><br><span class="line">                string key = e.AddedItems[0].ToString();</span><br><span class="line">                //检查设置是否存在这个key</span><br><span class="line">                <span class="keyword">if</span> (_appSettings.Values.ContainsKey(key)) &#123;</span><br><span class="line">                    txtKey.Text = key;</span><br><span class="line">                    //获取key的值并显示在文本框上</span><br><span class="line">                    txtValue.Text = _appSettings.Values[key].ToString();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>6.13.存储容器设置<br>1.容器的创建<br>容器的创建必须依赖容器的对象,也就是说必须要在容器下面创建容器,所以容器里是可以嵌套着容器的,<br>但是这个嵌套的层次不能超过32层.首先需要获取根容器,然后调用ApplicationDataContainer.CreateContainer方法,可创建设置容器.该方法有两个参数,第一个是容器的名字,注意同一个容器里面不能有相同名字的两个容器,第二个是ApplicationDataCreateDisposition枚举,通常会设置为枚举中的Always值,表示如果容器不存在则新建一个再返回容器对象.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ApplicationDataContainer container=localSettings.CreateContainer(<span class="string">&quot;exampleContainer&quot;</span>,ApplicationDataCreateDisposition.Always);</span><br></pre></td></tr></table></figure>
<p>2.容器的删除<br>容器的删除可以调用ApplicationDataContainer.DeleteContainer方法,通过传入容器的名称可以删除当前容器下的该名称的容器,注意不是删除容器对象的这个容器.删除容器后,容器下面的应用设置信息也会全部删除掉.所以在做容器删除时一定要确认该容器下面的应用设置信息是否已经完全不需要了,否则会造成信息的丢失.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localSettings.DeleteContainer(<span class="string">&quot;exampleContainer&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;ApplicationDataContainer&quot;</span>&gt;</span><br><span class="line">               &lt;StackPanel&gt;</span><br><span class="line">                   &lt;Button Content=<span class="string">&quot;创建Container&quot;</span> Click=<span class="string">&quot;CreateContainer_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line">                   &lt;Button Content=<span class="string">&quot;添加信息&quot;</span> Click=<span class="string">&quot;WriteSetting_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line">                   &lt;Button Content=<span class="string">&quot;删除信息&quot;</span> Click=<span class="string">&quot;DeleteSetting_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line">                   &lt;Button Content=<span class="string">&quot;删除Container&quot;</span> Click=<span class="string">&quot;DeleteContainer_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line">                   &lt;TextBlock x:Name=<span class="string">&quot;OutputTextBlock&quot;</span> TextWrapping=<span class="string">&quot;Wrap&quot;</span>/&gt;</span><br><span class="line">               &lt;/StackPanel&gt;</span><br><span class="line">           &lt;/PivotItem&gt;</span><br><span class="line"></span><br><span class="line"> ///获取根容器</span><br><span class="line">           localSettings=ApplicationData.Current.LocalSettings;</span><br><span class="line">           //输出容器相关信息</span><br><span class="line">           DisplayOutput();</span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">       /// 展示创建的容器和应用设置的信息</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       private void <span class="function"><span class="title">DisplayOutput</span></span>()</span><br><span class="line">       &#123;</span><br><span class="line">          //判断容器是否存在</span><br><span class="line">          bool hasContainer=localSettings.Containers.ContainsKey(containerName);</span><br><span class="line">           //判断容器里面的键值是否存在</span><br><span class="line">           bool hasSetting = hasContainer ? localSettings.Containers[containerName].Values.ContainsKey(settingName) : <span class="literal">false</span>;</span><br><span class="line">           string output = string.Format(</span><br><span class="line">               $<span class="string">&quot;Container Exists:&#123;(hasContainer?true:false)&#125;\n Setting Exists:&#123;(hasSetting?true:false)&#125;&quot;</span>);</span><br><span class="line">           OutputTextBlock.Text = output;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">       /// 创建一个容器</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private void CreateContainer_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           //如果容器不存在则新建</span><br><span class="line">           ApplicationDataContainer container = localSettings.CreateContainer(containerName, ApplicationDataCreateDisposition.Always);</span><br><span class="line">           DisplayOutput();</span><br><span class="line">       &#125;</span><br><span class="line">       //在新建的容器上添加应用设置信息</span><br><span class="line">       private void WriteSetting_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">if</span> (localSettings.Containers.ContainsKey(containerName))</span><br><span class="line">           &#123;</span><br><span class="line">               localSettings.Containers[containerName].Values[settingName] = <span class="string">&quot;Hello World&quot;</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           DisplayOutput();</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 删除容器上的应用设置信息</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private void DeleteSetting_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">if</span> (localSettings.Containers.ContainsKey(containerName))</span><br><span class="line">           &#123;</span><br><span class="line">               localSettings.Containers[containerName].Values.Remove(settingName);</span><br><span class="line">           &#125;</span><br><span class="line">           DisplayOutput();</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 删除所创建的容器</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private void DeleteContainer_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           localSettings.DeleteContainer(containerName);</span><br><span class="line">           DisplayOutput();</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>6.14.复合设置数据<br>应用设置还支持一个特殊的类型 ApplicationDataCompositeValue,就是复合设置.<br>ApplicationDataCompositeValue类表示必须进行自动序列化和反序列化的相关应用程序的设置.<br>复合设置通过将其插入设置映射而序列化,通过从映射查找该设置而反序列化.针对少量数据进行了优化,用于大型数据集，性能可能很差.所以复合设置使用的场景通常是将一组互相依赖的数据捆绑在一起,保证在任何情况下,他们都是作为一个整体进行操作.复合设置是应用设置中的一种,所以其相关的操作和应用设置一致.ApplicationDataCompositeValue对象也是一个键/值对的对象类型.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationDataCompositeValue composite=new ApplicationDataCompositeValue();</span><br><span class="line">composite[<span class="string">&quot;intVal&quot;</span>]=1;</span><br><span class="line">composite[<span class="string">&quot;strVal&quot;</span>]=<span class="string">&quot;string&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"> &lt;PivotItem Header=<span class="string">&quot;ApplicationDataCompositeValue&quot;</span>&gt;</span><br><span class="line">                &lt;StackPanel&gt;</span><br><span class="line">                    &lt;Button Content=<span class="string">&quot;创建&quot;</span> Click=<span class="string">&quot;WriteCompositeSetting_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;Button Content=<span class="string">&quot;删除&quot;</span> Click=<span class="string">&quot;DeleteCompositeSetting_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;TextBlock x:Name=<span class="string">&quot;OutputTextBlock1&quot;</span> TextWrapping=<span class="string">&quot;Wrap&quot;</span>/&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">            &lt;/PivotItem&gt;</span><br><span class="line"></span><br><span class="line"> ///ApplicationDataCompositiveValue</span><br><span class="line">            roamingSettings=ApplicationData.Current.LocalSettings;</span><br><span class="line">            //展示信息</span><br><span class="line">            DisplayOutputAdcv();</span><br><span class="line"></span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">        /// 展示复合设置的信息</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private void <span class="function"><span class="title">DisplayOutputAdcv</span></span>()</span><br><span class="line">        &#123;</span><br><span class="line">            ApplicationDataCompositeValue composite = (ApplicationDataCompositeValue)roamingSettings.Values[settingNameA];</span><br><span class="line">            string output;</span><br><span class="line">            <span class="keyword">if</span> (composite==null)</span><br><span class="line">            &#123;</span><br><span class="line">                output = <span class="string">&quot;复合设置信息为空&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                output =$<span class="string">&quot;复合设置:&#123;settingNameB&#125;=&#123;composite[settingNameB]&#125;,&#123;settingNameC&#125;=&#123;composite[settingNameC]&#125;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            OutputTextBlock1.Text = output;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"> ApplicationDataContainer roamingSettings = null;</span><br><span class="line">        //复合设置的名称</span><br><span class="line">        const string settingNameA = <span class="string">&quot;exampleCompositeSetting&quot;</span>;</span><br><span class="line">        //复合设置里面的键One</span><br><span class="line">        const string settingNameB = <span class="string">&quot;one&quot;</span>;</span><br><span class="line">        //复合设置里面的键two</span><br><span class="line">        const string settingNameC = <span class="string">&quot;two&quot;</span>;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 写入复合设置信息</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private void WriteCompositeSetting_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            ApplicationDataCompositeValue composite=new ApplicationDataCompositeValue();</span><br><span class="line">            composite[settingNameB] = 1;</span><br><span class="line">            composite[settingNameC] = <span class="string">&quot;world&quot;</span>;</span><br><span class="line">            roamingSettings.Values[settingNameA]=composite;</span><br><span class="line">            DisplayOutputAdcv();</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 删除复合设置信息</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private void DeleteCompositeSetting_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            roamingSettings.Values.Remove(settingNameA);</span><br><span class="line">            DisplayOutputAdcv();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>6.2 应用文件存储<br>在每个应用的应用数据存储中,该应用拥有系统定义的根目录,一个用于本地文件,一个用于漫游文件,还有一个用于临时文件,应用可向根目录添加新文件和新目录,创建新目录可组织文件,分本地和漫游<br>6.21.三种类型的应用文件<br>1.本地应用文件<br>存储在客户端的存储数据,存储区域属于程序的沙箱里,应用程序自己才可以访问,保障了数据的安全性.应用程序卸载后无法恢复.本地应用文件的根目录文件夹可以通过ApplicationData对象的LocalFolder属性来访问,即ApplicationData.Current.LocalFolder,类型是文件夹(StorageFolder)对象.<br>2.漫游应用文件<br>漫游应用文件是指对同一个账号登录的设备共享的数据,用户可以轻松在多个设备保持应用数据同步.漫游应用文件的根目录文件夹可以通过ApplicationData对象的RoamingFolder属性来访问.也就是ApplicationData.Current.RoamingFolder.<br> 1.数据大小有限制.<br>大小由ApplicationData类的RoamingStorageQuota属性决定.RoamingStorageQuota属性表示获取可从漫游应用程序数据存储区同步到云的数据的最大值,如果漫游数据在漫游应用程序数据存储区中的当前大小超过RoamingStorageQuota指定的最大值,则系统会挂起并将包中所有应用程序的数据复制到云,直到当前大小不再超过最大值.出于此原因,最好的做法是仅为用户首选项,链接和小型数据文件使用漫游数据.<br> 2.数据改变时机的不确定性<br>如果需要监控漫游数据的变化,应用应该注册处理ApplicationData类的DataChanged事件,处理操作在漫游应用程序更改时执行.<br> 3.数据版本的一致性<br>更新新版本之前,不会将应用数据更新到用户安装了该应用的其他设备.<br> 4.漫游数据不是永久的,有时间限制.<br>漫游数据同步并不是无期限同步的,它有一个30天的时间间隔限制,用户可在此时间间隔访问漫游数据.超过 云删除.卸载 漫游数据保留  在改时间间隔重新安装,会从云中同步漫游数据.<br> 5.漫游数据同步时机依赖于网络和设备<br>随机 漫游数据是应用设置,可以通过特殊的设置键来设置一个高优先级别的漫游设置数据,可以更快频繁和快速同步到云端.这个高优先级别的key为HighPriority,系统会以最快的速度在多个设备间同步HighPriority所对应的数据.它支持ApplicationDataCompositeValue数据,但总大小限于8KB,限值不是强制的,超过视为常规漫游。<br>3.临时应用文件<br>类似缓存,不会漫游,随时删除.磁盘清理清除 用于存储应用会话期间的临时信息,无法保证超出应用会话结束时间后仍将保留此数据.临时应用文件的根目录文件夹可以通过ApplicationData对象的TemporaryFolder属性来访问,也就是ApplicationData.Current.TemporaryFolder.<br>6.22.应用文件和文件夹操作<br>win10对应用数据所进行的操作,就是对应用文件夹和文件的操作.<br>StorageFolder类表示操作文件夹及其内容,并提供有关它们的信息,用于向本地文件夹内的某个文件读取和写入数据.在设备存储里文件夹的根目录分别为本地文件夹(ApplicationData.Current.LocalFolder),漫游文件夹(ApplicationData.Current.RoamingFolder)和临时文件夹(ApplicationData.Current.TemporaryFolder).<br>Storage类表示文件,提供有关文件及其内容和操作信息.StorageFolder类和StorageFile类是两个关系非常密切的类<br>StorageFolder类的主要成员<br>DateCreated 获取创建文件夹的日期和时间<br>Name 获取存储文件夹的名称<br>Path 获取存储文件夹的路径<br>CreteFileAsync(string desiredName) 在文件夹或文件组中创建一个新文件,desiredName:要创建的文件的所需名称,返回表示新文件的StorageFile<br>CreateFolderAsync(string desiredName) 在当前文件夹中创建新的文件夹.desiredName:要创建的文件夹所需名称.返回表示新文件夹的StorageFolder.<br>DeleteAsync(); 删除当前文件夹或文件组.<br>GetFileAsync(string name) 从当前文件夹获取指定文件.name:要检索的文件的名称.返回表示文件的StorageFile.<br>GetFilesAsync() 在当前文件夹中获取文件.返回文件夹中的文件列表(类型IReadOnlyList<StorageFile>).列表中的每个文件均由一个StorageFile对象表示.<br>GetFolderAsync(string name) 从当前文件夹获取指定文件夹.name:要检索的文件夹的名称.返回表示子文件夹的StorageFolder.<br>RenameAsync(string desiredName) 重命名当前文件夹.desiredName:当前文件夹所需的新名称.<br>StorageFile类的主要成员<br>DateCreated 获取创建文件夹的日期和时间<br>Name 获取存储文件夹的名称<br>Path 获取存储文件夹的路径<br>CopyAndReplaceAsync(IStorageFile fileToReplace) 将指定文件替换为当前文件的副本.fileToReplace:要替换的文件<br>CopyAsync(IStorageFolder destinationFolder):在指定文件夹中创建文件的副本.destinationFolder:从中创建副本的目标文件夹.返回表示副本的StorageFile<br>CopyAsync(IStorageFolder destinationFolder,string desiredNewName) 使用所需的名称,在指定文件夹中创建文件的副本.destinationFolder:从中创建副本的目标文件夹.desiredNewName:副本的所需名称.如果在已经指定desiredNewName的目标文件夹中存在现有文件,则为副本生成唯一的名称.返回表示副本的StorageFile<br>DeleteAsync() 删除当前文件<br>GetFileFromPathAsync(string path) 获取StorageFIle对象以代表指定路径中的文件.path:表示获取StorageFile的文件路径.返回表示文件的StorageFile<br>RenameAsync(string desiredName) 重命名当前文件.desiredName:当前项所需的新名称.<br>1.创建文件夹和文件<br>对于根目录里的StorageFolder对象,可以直接通过ApplicationData类的单例来获取,在文件夹里面再创建文件夹,可以调用StorageFolder.CreateFolderAsync方法在本地文件夹中创建一个文件夹目录,以及调用StorageFolder.CreateFileAsync方法在本地文件夹中创建一个文件.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">        /// 创建文件夹和文件</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private async void <span class="function"><span class="title">GetLocalFolder</span></span>()</span><br><span class="line">        &#123;</span><br><span class="line">            //获取本地文件夹根目录</span><br><span class="line">            StorageFolder <span class="built_in">local</span> = Windows.Storage.ApplicationData.Current.LocalFolder;</span><br><span class="line">            //创建文件夹,如果文件夹存在则打开它</span><br><span class="line">            var dataFolder =await local.CreateFolderAsync(<span class="string">&quot;DataFolder&quot;</span>,CreationCollisionOption.OpenIfExists);</span><br><span class="line">            //创建一个命名为DataFile.txt的文件,如果文件存在则替换掉</span><br><span class="line">            var file = await dataFolder.CreateFileAsync(<span class="string">&quot;DataFile.txt&quot;</span>,CreationCollisionOption.ReplaceExisting);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>2.文件的读写<br>可以使用StreamReader,StreamWriter类,FileIO类<br>使用S可以读取/写入标准文本文件的各行信息.StreamReader/StreamWriter的默认编码为UTF-8.UTF-8可以正确处理Unicode字符并提供一致的结果.FileIO类是专门为IStorageFile类型的对象表示读取/写入文件提供帮助的方法,FileIO类是一个静态类,直接调用其静态的文件读写方法来进行操作.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">        /// 2.文件的读写</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private async void ReadWrite(StorageFile file) &#123;</span><br><span class="line">            //读取文件的文本信息,使用FileIO类实现</span><br><span class="line">            string fileContent = await FileIO.ReadTextAsync(file);</span><br><span class="line">            //读取文件的文本信息,使用StreamReader类实现</span><br><span class="line">            using (StreamReader streamReader = new StreamReader(file.Path))</span><br><span class="line">            &#123;</span><br><span class="line">                fileContent = streamReader.ReadToEnd();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            //写入文件的文本信息,使用FileIO类实现</span><br><span class="line">            await FileIO.WriteTextAsync(file, <span class="string">&quot;Windows 10&quot;</span>);</span><br><span class="line">            //写入文件的文本信息,使用StreamWriter类实现.</span><br><span class="line">            using (StreamWriter swNew=new StreamWriter(file.Path))</span><br><span class="line">            &#123;</span><br><span class="line">                swNew.WriteLine(<span class="string">&quot;Windows 10&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>还可以使用WindowsRuntimeStorageExtensions类提供的实现IStorageFile和IStorageFolder接口类使用的方法来进行文件和文件夹的读写操作,这些扩展的方法分别有OpenStreamForReadAsync和OpenStreamForWriteAsync.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"> //使用OpenStreamForWriteAsync方法来实现写入文件信息</span><br><span class="line">           byte[] fileBytes=Encoding.UTF8.GetBytes(<span class="string">&quot;Windows 10&quot;</span>.ToCharArray());</span><br><span class="line">           using (var s=await file.OpenStreamForWriteAsync())</span><br><span class="line">           &#123;</span><br><span class="line">               s.Write(fileBytes,0,fileBytes.Length);</span><br><span class="line">           &#125;</span><br><span class="line">          ///文件删除,复制,重命名和移动操作</span><br><span class="line">           //await file.DeleteAsync();</span><br><span class="line">           var newfile =await storageFolder.CreateFileAsync(<span class="string">&quot;sample - Copy.txt&quot;</span>, CreationCollisionOption.ReplaceExisting);</span><br><span class="line">           //复制文件</span><br><span class="line">           StorageFile fileCopy = await file.CopyAsync(storageFolder,<span class="string">&quot;sample - Copy.txt&quot;</span>,NameCollisionOption.ReplaceExisting);</span><br><span class="line">           //重命名文件</span><br><span class="line">           await file.RenameAsync(<span class="string">&quot;sampleRe.txt&quot;</span>);</span><br><span class="line">           var newStorageFolder = await storageFolder.CreateFolderAsync(<span class="string">&quot;newDataFolder&quot;</span>, CreationCollisionOption.OpenIfExists);</span><br><span class="line">           //移动文件</span><br><span class="line">           await file.MoveAsync(newStorageFolder,<span class="string">&quot;newDataFile&quot;</span>);</span><br><span class="line">//文件名</span><br><span class="line">       private string fileName = <span class="string">&quot;testfile.txt&quot;</span>;</span><br><span class="line">       //保存按钮事件处理程序</span><br><span class="line">       private async void bt_save_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">if</span> (infoStorage.Text!=<span class="string">&quot;&quot;</span>)</span><br><span class="line">           &#123;</span><br><span class="line">               //写入文件信息</span><br><span class="line">               await WriteFile(fileName,infoStorage.Text);</span><br><span class="line">               await new MessageDialog(<span class="string">&quot;保存成功&quot;</span>).ShowAsync();</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">               await new MessageDialog(<span class="string">&quot;内容不能为空&quot;</span>).ShowAsync();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 写入本地文件夹根目录的文件</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;fileName&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;text&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">       /// &lt;exception cref=<span class="string">&quot;NotImplementedException&quot;</span>&gt;&lt;/exception&gt;</span><br><span class="line">       private async Task WriteFile(string fileName, string text)</span><br><span class="line">       &#123;</span><br><span class="line">           //获取本地文件夹根目录文件夹</span><br><span class="line">           IStorageFolder applicationFolder=ApplicationData.Current.LocalFolder;</span><br><span class="line">           //在文件夹里面创建文件,如果文件存在则替换掉.</span><br><span class="line">           IStorageFile storageFile = await applicationFolder.CreateFileAsync(fileName,CreationCollisionOption.OpenIfExists);</span><br><span class="line">           //使用FileIO类把字符串信息写入文件</span><br><span class="line">           await FileIO.WriteTextAsync(storageFile, text);</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 删除文件</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private async void bt_delete_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           string text;</span><br><span class="line">           try</span><br><span class="line">           &#123;</span><br><span class="line">               IStorageFolder applicationFolder = ApplicationData.Current.LocalFolder;</span><br><span class="line">               //获取文件</span><br><span class="line">               IStorageFile storageFile=await applicationFolder.GetFileAsync(fileName);</span><br><span class="line">               //删除当前的文件</span><br><span class="line">               await storageFile.DeleteAsync();</span><br><span class="line">               text = <span class="string">&quot;删除成功&quot;</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           catch (Exception ex)</span><br><span class="line">           &#123;</span><br><span class="line"></span><br><span class="line">               text = <span class="string">&quot;文件删除错误:&quot;</span> + ex.Message;</span><br><span class="line">           &#125;</span><br><span class="line">           await new MessageDialog(text).ShowAsync();</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 读取文件</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private async void bt_read_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           //读取文件的文本信息</span><br><span class="line">           string content = await ReadFile(fileName);</span><br><span class="line">           await new MessageDialog(content).ShowAsync();</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 读取本地文件夹根目录的文件</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;fileName&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">       /// &lt;exception cref=<span class="string">&quot;NotImplementedException&quot;</span>&gt;&lt;/exception&gt;</span><br><span class="line">       private async Task&lt;string&gt; ReadFile(string fileName)</span><br><span class="line">       &#123;</span><br><span class="line">           string text;</span><br><span class="line">           try</span><br><span class="line">           &#123;</span><br><span class="line">               //获取本地文件夹根目录文件夹</span><br><span class="line">               IStorageFolder applicaitonFolder=ApplicationData.Current.LocalFolder;</span><br><span class="line">               //根据文件名获取文件夹里面的文件</span><br><span class="line">               IStorageFile storageFile=await applicaitonFolder.GetFileAsync(fileName);</span><br><span class="line">               //打开文件获取文件的数据流</span><br><span class="line">               IRandomAccessStream accessStream=await storageFile.OpenReadAsync();</span><br><span class="line">               //使用StreamReader读取文件的内容,需要将IRandomAccessStream对象转换为Stream对象来初始化StreamReader对象.</span><br><span class="line">               using (StreamReader streamReader=new StreamReader(accessStream.AsStreamForRead((int)accessStream.Size)))</span><br><span class="line">               &#123;</span><br><span class="line">                   text = streamReader.ReadToEnd();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           catch (Exception e)</span><br><span class="line">           &#123;</span><br><span class="line">               text = <span class="string">&quot;文件读取错误:&quot;</span> + e.Message;</span><br><span class="line">             </span><br><span class="line">           &#125;</span><br><span class="line">           <span class="built_in">return</span> text;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6.23.文件Stream和Buffer读写操作<br>操作二进制文件,需要用到DataWriter类和DataReader类,DataWriter类用于写入文件的信息.当然这个信息不仅仅是文本信息<br>1.Buffer的写入操作<br>win10里,文件的Buffer操作使用的是IBuffer对象,所以要使用DataWriter类写入相关的信息之后再转换为IBuffer对象,然后保存到文件中.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">using(InMemoryRandomAccessStream memoryStream=new InMemoryRandomAccessStream())&#123;</span><br><span class="line">	using(DataWriter dataWriter=new DataWriter(memoryStream))&#123;</span><br><span class="line">	//文件相关的信息,可以根据文件的规则来进行写入</span><br><span class="line">	dataWriter.WriterInt32(size);</span><br><span class="line">	dataWriter.WriteString(userContent);</span><br><span class="line">	buffer=dataWriter.DetachBuffer();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">await FileIO.WriteBufferAsync(file,buffer);</span><br></pre></td></tr></table></figure>
<p>2.Buffer的读取操作<br>读取的操作其实就是获取文件的IBuffer对象之后,再使用IBuffer对象初始化一个DataReader对象,就可以对文件进行读取操作了.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">IBuffer buffer=await FileIO.ReadBufferAsync(file);</span><br><span class="line">using(DataReader dataReader=DataReader.FromBuffer(buffer))&#123;</span><br><span class="line">	//读取文件相关的信息,读取的规则要与文件的规则一致.</span><br><span class="line">	Int32 stringSize=dataReader.ReadInt32();</span><br><span class="line">	string fileContent=dataReader.ReadString((uint)stringSize);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.Stream的写入操作<br>文件的Stream其实就是文件内的信息,所以在用Stream来写入文件的数据时,直接保存Stream的信息就可以,并不需要再调用文件的对象进行保存.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">using(StorageStreamTransaction transaction=await file.OpenTransactedWriteAsync())&#123;</span><br><span class="line">	using(DataWriter dataWriter=new DataWriter(transaction.Stream))&#123;</span><br><span class="line">	//文件相关的信息,可以根据文件的规则进行写入</span><br><span class="line">	dataWriter.WriteInt32(size);</span><br><span class="line">	dataWriter.WriteString(userContent);</span><br><span class="line">	... ...</span><br><span class="line">	transaction.Stream.Size=await dataWriter.StoreAsync();</span><br><span class="line">	//保存Stream数据</span><br><span class="line">	await transaction.CommitAsync();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.Stream的读取操作<br>使用Stream读取文件的内容,需要先调用DataReader类的LoadAsync方法,把数据加载进来,再调用相关的Read方法来读取文件的内容;Buffer的操作不用调用LoadAsync方法,那是因为其已经一次性把数据都读取出来了.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">using(IRandomAccessStream readStream=await file.OpenAsync(FileAccessMode.Read))&#123;</span><br><span class="line">	//读取文件相关的信息,读取的规则要与文件的规则一致</span><br><span class="line">	await dataReader.LoadAsync(sizeof(Int32));</span><br><span class="line">	Int32 stringSize=dataReader.ReadInt32();</span><br><span class="line">	await dataReader.LoadAsync((UInt32)stringSize);</span><br><span class="line">	string fileContent=dataReader.ReadString((uint)stringSize);</span><br><span class="line">	... ...	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>文件Stream和Buffer读写操作的示例,演示了文件格式是先写入字符串内容的长度,Int32类型占用4个字节,然后再写入字符串的内容;读取文件的时候再按照这样的方式逆着来.按文件格式读取正确数据.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;StreamBuffer&quot;</span>&gt;</span><br><span class="line">                &lt;StackPanel&gt;</span><br><span class="line">                    &lt;Button x:Name=<span class="string">&quot;bt_crreate&quot;</span> Content=<span class="string">&quot;创建一个测试文件&quot;</span> Margin=<span class="string">&quot;2&quot;</span> Click=<span class="string">&quot;bt_crreate_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;Button x:Name=<span class="string">&quot;bt_writebuffer&quot;</span> Content=<span class="string">&quot;写入buffer&quot;</span> Margin=<span class="string">&quot;2&quot;</span> Click=<span class="string">&quot;bt_writebuffer_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;Button x:Name=<span class="string">&quot;bt_readbuffer&quot;</span> Content=<span class="string">&quot;读取buffer&quot;</span> Margin=<span class="string">&quot;2&quot;</span> Click=<span class="string">&quot;bt_readbuffer_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;Button x:Name=<span class="string">&quot;bt_writestream&quot;</span> Content=<span class="string">&quot;写入stream&quot;</span> Margin=<span class="string">&quot;2&quot;</span> Click=<span class="string">&quot;bt_writestream_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;Button x:Name=<span class="string">&quot;bt_readstream&quot;</span> Content=<span class="string">&quot;读取stream&quot;</span> Margin=<span class="string">&quot;2&quot;</span> Click=<span class="string">&quot;bt_readstream_Click&quot;</span>/&gt;</span><br><span class="line">                    &lt;TextBlock x:Name=<span class="string">&quot;StreambufferTextBlock&quot;</span> TextWrapping=<span class="string">&quot;Wrap&quot;</span> FontSize=<span class="string">&quot;20&quot;</span>/&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">            &lt;/PivotItem&gt;</span><br><span class="line"></span><br><span class="line">   /// &lt;summary&gt;</span><br><span class="line">        /// 创建的测试文件对象</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private StorageFile sampleFile;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 文件名</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private string filename = <span class="string">&quot;sampleFile.dat&quot;</span>;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 创建一个文件事件处理程序</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void bt_crreate_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            StorageFolder storageFolder= ApplicationData.Current.LocalFolder;</span><br><span class="line">            sampleFile=await storageFolder.CreateFileAsync(filename,CreationCollisionOption.ReplaceExisting);</span><br><span class="line">            StreambufferTextBlock.Text = $<span class="string">&quot;文件&#123;sampleFile.Name&#125;已经创建好.&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 写入IBuffer按钮事件处理程序</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void bt_writebuffer_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            StorageFile file = sampleFile;</span><br><span class="line">            <span class="keyword">if</span> (file!=null)</span><br><span class="line">            &#123;</span><br><span class="line">                try</span><br><span class="line">                &#123;</span><br><span class="line">                    string userContent = <span class="string">&quot;测试的文本消息&quot;</span>;</span><br><span class="line">                    IBuffer buffer;</span><br><span class="line">                    //使用一个内存的可访问的数据流创建一个DataWriter对象,写入String 再转换为IBuffer对象.</span><br><span class="line">                    using (InMemoryRandomAccessStream memoryStream=new InMemoryRandomAccessStream())</span><br><span class="line">                    &#123;</span><br><span class="line">                        //把String信息转换为IBuffer对象.</span><br><span class="line">                        using (DataWriter dataWriter=new DataWriter(memoryStream))</span><br><span class="line">                        &#123;</span><br><span class="line">                            //先写入字符串的长度信息</span><br><span class="line">                            dataWriter.WriteInt32(Encoding.UTF8.GetByteCount(userContent));</span><br><span class="line">                            //写入字符串信息</span><br><span class="line">                            dataWriter.WriteString(userContent);</span><br><span class="line">                            buffer=dataWriter.DetachBuffer();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    await FileIO.WriteBufferAsync(file,buffer);</span><br><span class="line">                    StreambufferTextBlock.Text = $<span class="string">&quot;长度为:&#123;buffer.Length&#125; bytes的文本信息写入到了文件&#123;file.Name&#125;:&#123;Environment.NewLine+Environment.NewLine+userContent&#125;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (Exception ex)</span><br><span class="line">                &#123;</span><br><span class="line">                    StreambufferTextBlock.Text =$<span class="string">&quot;异常:&#123;ex.Message&#125;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                StreambufferTextBlock.Text = <span class="string">&quot;请先创建文件&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 读取IBuffer按钮事件处理程序</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void bt_readbuffer_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            StorageFile file= sampleFile;</span><br><span class="line">            <span class="keyword">if</span> (file != null)</span><br><span class="line">            &#123;</span><br><span class="line">                try</span><br><span class="line">                &#123;</span><br><span class="line">                    IBuffer buffer = await FileIO.ReadBufferAsync(file);</span><br><span class="line">                    using (DataReader dataReader = DataReader.FromBuffer(buffer))</span><br><span class="line">                    &#123;</span><br><span class="line">                        //先读取字符串的长度信息</span><br><span class="line">                        Int32 stringSize = dataReader.ReadInt32();         //读取字符串信息</span><br><span class="line">                        string fileContent = dataReader.ReadString((uint)stringSize);</span><br><span class="line">                        StreambufferTextBlock.Text = $<span class="string">&quot;长度为:&#123;buffer.Length&#125; bytes的文本信息从文件&#123;file.Name&#125;读取出来,其中字符串的长度为&#123;stringSize&#125;bytes:&#123;Environment.NewLine + fileContent&#125;&quot;</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (Exception ex)</span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                    StreambufferTextBlock.Text = <span class="string">&quot;异常:&quot;</span> + ex.Message;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                StreambufferTextBlock.Text = <span class="string">&quot;请先创建文件&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //写入Stream按钮事件处理程序.</span><br><span class="line">        private async void bt_writestream_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            StorageFile file= sampleFile;</span><br><span class="line">            <span class="keyword">if</span> (file!=null)</span><br><span class="line">            &#123;</span><br><span class="line">                try</span><br><span class="line">                &#123;</span><br><span class="line">                    string userContent = <span class="string">&quot;测试的文本信息&quot;</span>;</span><br><span class="line">                    //使用StorageStreamTransaction对象来创建DataWriter对象写入数据</span><br><span class="line">                    using (StorageStreamTransaction transaction=await file.OpenTransactedWriteAsync())</span><br><span class="line">                    &#123;</span><br><span class="line">                        using (DataWriter dataWriter=new DataWriter(transaction.Stream))</span><br><span class="line">                        &#123;</span><br><span class="line">                            //先写入信息的长度</span><br><span class="line">                            dataWriter.WriteInt32(Encoding.UTF8.GetByteCount(userContent));</span><br><span class="line">                            //写入字符串信息</span><br><span class="line">                            dataWriter.WriteString(userContent);</span><br><span class="line">                            //提交dataWriter的数据同时重设Stream的大小</span><br><span class="line">                            transaction.Stream.Size=await dataWriter.StoreAsync();</span><br><span class="line">                            //保存Stream数据</span><br><span class="line">                            await transaction.CommitAsync();</span><br><span class="line">                            StreambufferTextBlock.Text = $<span class="string">&quot;使用stream把信息写入了文件&#123;file.Name&#125;:&#123;Environment.NewLine+userContent&#125;&quot;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (Exception ex)</span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                    StreambufferTextBlock.Text = $<span class="string">&quot;异常:&quot;</span> + ex.Message;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                StreambufferTextBlock.Text = <span class="string">&quot;请先创建文件&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 读取Stream按钮事件处理程序</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void bt_readstream_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            StorageFile file=sampleFile;</span><br><span class="line">            <span class="keyword">if</span> (file!=null)</span><br><span class="line">            &#123;</span><br><span class="line">                try</span><br><span class="line">                &#123;</span><br><span class="line">                    //使用文件流创建DataReader对象</span><br><span class="line">                    using (IRandomAccessStream readStream=await file.OpenAsync(FileAccessMode.Read))</span><br><span class="line">                    &#123;</span><br><span class="line">                        using (DataReader dataReader=new DataReader(readStream))</span><br><span class="line">                        &#123;</span><br><span class="line">                            UInt64 size = readStream.Size;</span><br><span class="line">                            <span class="keyword">if</span> (size&lt;=UInt32.MaxValue)</span><br><span class="line">                            &#123;</span><br><span class="line">                                //先读取字符串的长度信息</span><br><span class="line">                                await dataReader.LoadAsync(sizeof(Int32));</span><br><span class="line">                                Int32 stringSize=dataReader.ReadInt32();</span><br><span class="line">                                //读取字符串的内容信息</span><br><span class="line">                                await dataReader.LoadAsync((UInt32)stringSize);</span><br><span class="line">                                string fileContent = dataReader.ReadString((UInt32)stringSize);</span><br><span class="line">                                StreambufferTextBlock.Text =$<span class="string">&quot;使用stream把信息从文件&#123;file.Name&#125;读取出来,其中字符串的长度为:&#123;stringSize&#125;bytes:&#123;Environment.NewLine+fileContent&#125;&quot;</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                            &#123;</span><br><span class="line">                                StreambufferTextBlock.Text = $<span class="string">&quot;文件&#123;file.Name&#125;太大,不能再单个数据块中读取&quot;</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                catch (Exception ex)</span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                    StreambufferTextBlock.Text = $<span class="string">&quot;异常:&#123;ex.Message&#125;&quot;</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                StreambufferTextBlock.Text = <span class="string">&quot;请先创建文件&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>6.24.应用文件的URI方案<br>3个根目录文件夹所对应的保存路径的格式分别如下:<br>1.LocalFolder文件夹保存路径格式:%USERPROFILE%\APPDATA\Local\Packages{PackageId}\LocalState.<br>2.RoamingFolder文件夹的保存路径格式:%USERPROFILE%\APPDATA\Local\Packages{PackageId}\RoamingState<br>3.TemporaryFolder文件夹的保存路径格式:%USERPROFILE%\APPDATA\Local\Packages{PackageId}\TempState<br>获取到的路径并不能作为访问文件的路径来使用,访问文件的路径需要使用本地文件夹的ms-appdata的URI方案.LocalFolder文件夹对应的是“ms-appdata:///local/”,RoamingFolder “ms-appdata:///roaming/“<br>TemporaryFolder ms-appdata:///temp/ 可以根据StorageFile类的静态方法GetFileFromApplicationUriAsync来根据URI读取文件.下面示例使用了ms-appdata的URI方法来获取在LocalFolder文件夹里面的AppConfigSettings.xml文件.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var file=await StorageFile.GetFileFromApplicationUriAsync(new Uri(<span class="string">&quot;ms-appdata:///local/AppConfigSettings.xml&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>在这种通过URI访问文件的方案里还需要注意,新文件和文件夹的路径在URI方案名称的最后一个斜杠后面不能超过185个字符.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;GetFolderByUri&quot;</span>&gt;</span><br><span class="line">               &lt;StackPanel&gt;</span><br><span class="line">                   &lt;TextBox Header=<span class="string">&quot;文件信息:&quot;</span> x:Name=<span class="string">&quot;UriInfo&quot;</span> TextWrapping=<span class="string">&quot;Wrap&quot;</span>/&gt;</span><br><span class="line">                   &lt;Button x:Name=<span class="string">&quot;bt_saveuri&quot;</span> Content=<span class="string">&quot;创建文件&quot;</span> Click=<span class="string">&quot;bt_save_Click_1&quot;</span>/&gt;</span><br><span class="line">                   &lt;Button x:Name=<span class="string">&quot;bt_readuri&quot;</span> Content=<span class="string">&quot;通过URI读取文件&quot;</span> Margin=<span class="string">&quot;2&quot;</span> Click=<span class="string">&quot;bt_read_Click_1&quot;</span>/&gt;</span><br><span class="line">                   </span><br><span class="line">               &lt;/StackPanel&gt;</span><br><span class="line">           &lt;/PivotItem&gt;</span><br><span class="line">//文件名</span><br><span class="line">       private string UrifileName = <span class="string">&quot;testfile.txt&quot;</span>;</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line"></span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 读取文件</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private async void bt_read_Click_1(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           //读取文件的文本信息</span><br><span class="line">           string text;</span><br><span class="line">           try</span><br><span class="line">           &#123;</span><br><span class="line">               //通过URI获取本地文件</span><br><span class="line">               var storageFile = await StorageFile.GetFileFromApplicationUriAsync(new Uri(<span class="string">&quot;ms-appdata:///local/&quot;</span>+UrifileName));</span><br><span class="line">               //打开文件获取文件的数据流</span><br><span class="line">               IRandomAccessStream accessStream = await storageFile.OpenReadAsync();</span><br><span class="line">               //使用StreamReader读取文件的内容,需要将IRandomAccessStream对象转换为Stream对象来初始化StreamReader对象.</span><br><span class="line">               using (StreamReader streamReader=new StreamReader(accessStream.AsStreamForRead((int)accessStream.Size)))</span><br><span class="line">               &#123;</span><br><span class="line">                   text = streamReader.ReadToEnd();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           catch (Exception ex)</span><br><span class="line">           &#123;</span><br><span class="line">               text = $<span class="string">&quot;文件读取错误:&quot;</span>+ex.Message;</span><br><span class="line">               </span><br><span class="line">           &#125;</span><br><span class="line">           await new MessageDialog(text).ShowAsync();</span><br><span class="line">       &#125;</span><br><span class="line">       //创建文件</span><br><span class="line">       private async void bt_save_Click_1(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">if</span> (UriInfo.Text != <span class="string">&quot;&quot;</span>) &#123; </span><br><span class="line">               //获取本地文件夹根目录文件夹</span><br><span class="line">               IStorageFolder applicationFolder=ApplicationData.Current.LocalFolder;</span><br><span class="line">               //在文件夹里面创建文件,如果文件存在则替换掉</span><br><span class="line">               IStorageFile storageFile = await applicationFolder.CreateFileAsync(UrifileName,CreationCollisionOption.OpenIfExists);</span><br><span class="line">               //使用FileIO类把字符串信息写入文件</span><br><span class="line">               await FileIO.WriteTextAsync(storageFile, UriInfo.Text);</span><br><span class="line">               await new MessageDialog($<span class="string">&quot;保存成功,文件的路径:&#123;storageFile.Path&#125;&quot;</span>).ShowAsync();</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span></span><br><span class="line">           &#123;</span><br><span class="line">               await new MessageDialog(<span class="string">&quot;内容不能为空&quot;</span>).ShowAsync();</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6.3.常用的存储数据格式<br>6.31.JSON数据序列化存储<br>JSON用于描述数据结构,有以下形式存在.<br>对象(object):一个对象以”{“开始”,”并以”}”退出.一个对象包含一系列非排序的名称/值对,每个名称/值对之间使用”,”分隔.<br>名称/值(collection):名称和值之间使用”:”隔开,一般的形式是{name;value}.一个名称是一个字符串,一个值可以是一个字符串,一个数值,一个对象,一个布尔值,一个有串行表或者一个null值.值的串行表(Array):一个或者多个值用”,”分区后,使用”[“,”]”括起来就形成了这样的列表.例如,[collection,collection]<br>在win10里如果要使用JSON数据格式来存储相关的信息会有两种编程方式;<br>1.使用DataContractJsonSerializer类对JSON数据进行序列化和反序列化<br>DataContractJsonSerializer类对Json数据进行序列化和反序列化,是最简洁的Json数据操作方式.序列化的过程是把实体类对象转换为Json字符串对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">       /// 对实体类进行序列化的方法</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;item&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">       public string ToJsonData(object item) &#123; </span><br><span class="line">           DataContractJsonSerializer serializer=new DataContractJsonSerializer(item.GetType());</span><br><span class="line">           string result = string.Empty;</span><br><span class="line">           using (MemoryStream ms=new MemoryStream())</span><br><span class="line">           &#123;</span><br><span class="line">               serializer.WriteObject(ms,item);</span><br><span class="line">               ms.Position = 0;</span><br><span class="line">               using (StreamReader reader=new StreamReader(ms))</span><br><span class="line">               &#123;</span><br><span class="line">                   result = reader.ReadToEnd();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="built_in">return</span> result;</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 把Json字符串反序列化成实体类对象</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;typeparam name=<span class="string">&quot;T&quot;</span>&gt;&lt;/typeparam&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;jsonString&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">       public T DataContractJsonDeSerializer&lt;T&gt;(string jsonString) &#123; </span><br><span class="line">       var ds=new DataContractJsonSerializer(typeof(T));</span><br><span class="line">           var ms=new MemoryStream(Encoding.UTF8.GetBytes(jsonString));</span><br><span class="line">           T obj=(T)ds.ReadObject(ms);</span><br><span class="line">           ms.Dispose();</span><br><span class="line">           <span class="built_in">return</span> obj;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>2.使用JsonObject对象来自定义Json对象<br>使用DataContractJsonSerializer类对json数据进行序列化和反序列化的操作很方便,但是却有一个弊端,它的灵活性很差.例如,序列化成的Json字符串的名称/值对的名称必须和类的属性完全一致.若要实现灵活复杂的Json数据进行序列化和反序列化的操作可以使用JsonObject类来进行自定义.<br>通过JsonObject类来创建一个如下的Json对象.<br>{“city”:”Beijing”,”street”:”Chaoyang Road”,”postcode”:100025}<br>创建其对应的JsonObject类实现的语法如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">JsonObject jsonObject=new JsonObject();</span><br><span class="line">JsonObject.SetNamedValue(<span class="string">&quot;city&quot;</span>,JsonValue.CreateStringValue(<span class="string">&quot;Beijing&quot;</span>));</span><br><span class="line">JsonObject.SetNamedValue(<span class="string">&quot;street&quot;</span>,JsonValue.CreateStringValue(<span class="string">&quot;Chaoyang Road&quot;</span>));</span><br><span class="line">jsonObject.setNamedValue(<span class="string">&quot;postcode&quot;</span>,JsonValue,CreateNumberValue(10025));</span><br></pre></td></tr></table></figure>
<p>获取JsonObject类对象”city”所对应的数值如下:<br>jsonObject.GetNamedString(“city”,”默认值”);</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;JsonObject&quot;</span>&gt;</span><br><span class="line">                &lt;StackPanel&gt;</span><br><span class="line">                    &lt;TextBlock Text=<span class="string">&quot;Write your message&quot;</span> FontSize=<span class="string">&quot;20&quot;</span>/&gt;</span><br><span class="line">                    &lt;TextBox x:Name=<span class="string">&quot;userName&quot;</span> Header=<span class="string">&quot;Name:&quot;</span>/&gt;</span><br><span class="line">                    &lt;TextBox x:Name=<span class="string">&quot;userAge&quot;</span> Header=<span class="string">&quot;Age:&quot;</span> InputScope=<span class="string">&quot;Number&quot;</span>/&gt;</span><br><span class="line">                    &lt;TextBlock Text=<span class="string">&quot;Your study school:&quot;</span> FontSize=<span class="string">&quot;20&quot;</span>/&gt;</span><br><span class="line">                    &lt;CheckBox Content=<span class="string">&quot;Haerbing School&quot;</span> x:Name=<span class="string">&quot;school1&quot;</span>/&gt;</span><br><span class="line">                    &lt;CheckBox Content=<span class="string">&quot;LanXiang School&quot;</span> x:Name=<span class="string">&quot;school2&quot;</span>/&gt;</span><br><span class="line">                    &lt;StackPanel Orientation=<span class="string">&quot;Horizontal&quot;</span> HorizontalAlignment=<span class="string">&quot;Center&quot;</span>&gt;</span><br><span class="line">                        &lt;Button Content=<span class="string">&quot;保存&quot;</span> x:Name=<span class="string">&quot;save&quot;</span> Click=<span class="string">&quot;save_Click&quot;</span>/&gt;</span><br><span class="line">                        &lt;Button Content=<span class="string">&quot;获取保存的信息&quot;</span> x:Name=<span class="string">&quot;get&quot;</span> Click=<span class="string">&quot;get_Click&quot;</span>/&gt;</span><br><span class="line">                        </span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                    &lt;TextBlock x:Name=<span class="string">&quot;JsonObjectInfo&quot;</span> TextWrapping=<span class="string">&quot;Wrap&quot;</span> FontSize=<span class="string">&quot;20&quot;</span>/&gt;</span><br><span class="line">                &lt;/StackPanel&gt;</span><br><span class="line">            &lt;/PivotItem&gt;</span><br><span class="line"> /// &lt;summary&gt;</span><br><span class="line">        /// 对实体类进行序列化的方法</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;item&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">        public string ToJsonData(object item) &#123; </span><br><span class="line">            DataContractJsonSerializer serializer=new DataContractJsonSerializer(item.GetType());</span><br><span class="line">            string result = string.Empty;</span><br><span class="line">            using (MemoryStream ms=new MemoryStream())</span><br><span class="line">            &#123;</span><br><span class="line">                serializer.WriteObject(ms,item);</span><br><span class="line">                ms.Position = 0;</span><br><span class="line">                using (StreamReader reader=new StreamReader(ms))</span><br><span class="line">                &#123;</span><br><span class="line">                    result = reader.ReadToEnd();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 把Json字符串反序列化成实体类对象</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;typeparam name=<span class="string">&quot;T&quot;</span>&gt;&lt;/typeparam&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;jsonString&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">        public T DataContractJsonDeSerializer&lt;T&gt;(string jsonString) &#123; </span><br><span class="line">        var ds=new DataContractJsonSerializer(typeof(T));</span><br><span class="line">            var ms=new MemoryStream(Encoding.UTF8.GetBytes(jsonString));</span><br><span class="line">            T obj=(T)ds.ReadObject(ms);</span><br><span class="line">            ms.Dispose();</span><br><span class="line">            <span class="built_in">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private const string UserDataKey = <span class="string">&quot;UserDataKey&quot;</span>;</span><br><span class="line">        private async void save_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (userName.Text==<span class="string">&quot;&quot;</span> || userAge.Text==<span class="string">&quot;&quot;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;请输入完整的信息&quot;</span>).ShowAsync();</span><br><span class="line">                <span class="built_in">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            ObservableCollection&lt;School&gt; education = new ObservableCollection&lt;School&gt;();</span><br><span class="line">            <span class="keyword">if</span> (school1.IsChecked == <span class="literal">true</span>) &#123;</span><br><span class="line">                education.Add(new School &#123; Id=<span class="string">&quot;id001&quot;</span>,Name=school1.Content.ToString()&#125;);</span><br><span class="line">               </span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (school2.IsChecked == <span class="literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                education.Add(new School &#123; Id = <span class="string">&quot;id002&quot;</span>, Name = school2.Content.ToString() &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            User user = new User &#123; Education=education,Id=Guid.NewGuid().ToString(),Name=userName.Text,Age=Int32.Parse(userAge.Text),Verified=<span class="literal">false</span>&#125;;</span><br><span class="line">            //使用DataContractJsonDeSerializer的实现方式</span><br><span class="line">            //string json=ToJsonData(user);</span><br><span class="line">            //使用JsonObject的实现方式</span><br><span class="line">            string json = user.Stringify();</span><br><span class="line">            JsonObjectInfo.Text = json;</span><br><span class="line">            _appSettings.Values[UserDataKey] = json;</span><br><span class="line">            await new MessageDialog(<span class="string">&quot;保存成功&quot;</span>).ShowAsync();</span><br><span class="line">        &#125;</span><br><span class="line">        // 把应用设置存储的Json数据转换为实体类对象.</span><br><span class="line">        private async void get_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!_appSettings.Values.ContainsKey(UserDataKey)) &#123;</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;未保存信息&quot;</span>).ShowAsync();</span><br><span class="line">                <span class="built_in">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            string json = _appSettings.Values[UserDataKey].ToString();</span><br><span class="line">            //使用DataContractJsonDeSerializer的实现方式</span><br><span class="line">            //User user = DataContractJsonDeSerializer&lt;User&gt;(json);</span><br><span class="line">            //使用JsonObject的实现方式</span><br><span class="line">            User user = new User(json);</span><br><span class="line">            string userInfo = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            userInfo = $<span class="string">&quot;Id:&#123;user.Id&#125; Name:&#123;user.Name&#125; Age:&#123;user.Age&#125;&quot;</span>;</span><br><span class="line">            foreach (var item <span class="keyword">in</span> user.Education)</span><br><span class="line">            &#123;</span><br><span class="line">                userInfo += $<span class="string">&quot;Education:Id:&#123;item.Id&#125; Name:&#123;item.Name&#125;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            await new MessageDialog(userInfo).ShowAsync();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6.32.XML文件存储<br>Xml是可扩展标记语言的缩写,用于创建内容并使用限定标记,从而使每个单词,短语或块称为可识别，可分类的信息.Xml是一种易于使用和扩展的标记语言,它比JSON使用得更加广泛,它也是一种简单的数据格式,是纯100%的ASCII文本,而ASCII的抗破坏能力是很强的 下面是一个非常简单的XML文档的格式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> enconding=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">test</span>&gt;</span><br><span class="line">Hello Windows 10</span><br><span class="line">&lt;/test&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>简写:<? xml?><br>1.使用DataContractSerializer类对Xml文件进行序列化和反序列化<br>DataContractSerializer类和DataContractJsonSerializer类是两个很相似的类,前者是针对Xml格式的数据,后者是针对Json的数据.<br>Person对象Name=”terry”,Age=41,通常上面的序列化方法存储到应用文件里.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Person xmlns:i=<span class="string">&quot;http://www.w3.org/2001/XMLSchema - instance&quot;</span> xmlns=<span class="string">&quot;http://schemas.datacontract.org/2004/07/DataContractSerializerDeno&quot;</span>&gt;&lt;Age&gt;41&lt;/Age&gt;</span><br><span class="line">&lt;Name&gt;terry&lt;/Name&gt;</span><br><span class="line">&lt;/Person&gt;</span><br></pre></td></tr></table></figure>
<p>2.使用XmlDocument类对Xml文件进行序列化和反序列化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">/// &lt;summary&gt;</span><br><span class="line">       /// 把实体类对象序列化成xml格式存储到文件里面</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;typeparam name=<span class="string">&quot;T&quot;</span>&gt;&lt;/typeparam&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;data&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;fileName&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">       public async Task SaveAsync&lt;T&gt;(T data, string fileName) &#123;</span><br><span class="line">           StorageFile file = await ApplicationData.Current.LocalFolder.CreateFileAsync(fileName,CreationCollisionOption.ReplaceExisting);</span><br><span class="line">           //获取文件的数据流来进行操作.</span><br><span class="line">           using (IRandomAccessStream raStream=await file.OpenAsync(FileAccessMode.ReadWrite))</span><br><span class="line">           &#123;</span><br><span class="line">               using (IOutputStream outputStream=raStream.GetOutputStreamAt(0))</span><br><span class="line">               &#123;</span><br><span class="line">                   //创建序列化对象写入数据</span><br><span class="line">                   DataContractSerializer serializer = new DataContractSerializer(typeof(T));</span><br><span class="line">                   serializer.WriteObject(outputStream.AsStreamForWrite(),data);</span><br><span class="line">                   await outputStream.FlushAsync();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 反序列化XML文件</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;typeparam name=<span class="string">&quot;T&quot;</span>&gt;&lt;/typeparam&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;filename&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">       public async Task&lt;T&gt; ReadAsync&lt;T&gt;(string filename) &#123;</span><br><span class="line">           //获取实体类类型实例化一个对象</span><br><span class="line">           T sessionState_ = default(T);</span><br><span class="line">           StorageFile file = await ApplicationData.Current.LocalFolder.GetFileAsync(filename);</span><br><span class="line">           <span class="keyword">if</span> (file == null) <span class="built_in">return</span> sessionState_;</span><br><span class="line">           using (IInputStream inStream=await file.OpenSequentialReadAsync())</span><br><span class="line">           &#123;</span><br><span class="line">               //反序列化XML数据</span><br><span class="line">               DataContractSerializer serializer = new DataContractSerializer(typeof(T));</span><br><span class="line">               sessionState_ = (T)serializer.ReadObject(inStream.AsStreamForRead());</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="built_in">return</span> sessionState_;</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// </span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       public void <span class="function"><span class="title">SaveAsXml</span></span>() &#123;</span><br><span class="line">           //创建一个XmlDocument对象代表着是一个Xml的文档对象.</span><br><span class="line">           XmlDocument dom = new XmlDocument();</span><br><span class="line">           //创建和添加一条XML的评论</span><br><span class="line">           XmlComment dec = dom.CreateComment(<span class="string">&quot;THis is Students Message.&quot;</span>);</span><br><span class="line">           dom.AppendChild(dec);</span><br><span class="line"></span><br><span class="line">           //添加一个students的元素为Xml文档的根元素</span><br><span class="line">           XmlElement x = dom.CreateElement(<span class="string">&quot;studetns&quot;</span>);</span><br><span class="line">           dom.AppendChild(x);</span><br><span class="line">           //创建一个Student元素后面再添加到students元素的节点上</span><br><span class="line">           XmlElement x1 = dom.CreateElement(<span class="string">&quot;Student&quot;</span>);</span><br><span class="line">           //在Student元素里再添加<span class="built_in">id</span>和name两个元素节点,在节点内还添加了文本内容</span><br><span class="line">           XmlElement x11 = dom.CreateElement(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">           x11.InnerText = <span class="string">&quot;id001&quot;</span>;</span><br><span class="line">           x1.AppendChild(x11);</span><br><span class="line">           XmlElement x12 = dom.CreateElement(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">           x12.InnerText = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">           x1.AppendChild(x12);</span><br><span class="line">           x.AppendChild(x1);</span><br><span class="line"></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>XML文档操作相关的类和说明<br>Document  XmlDocument类  树中所有节点的容器,也称作文档根,文档根并非总是与根元素相同<br>DocumentFragment  XmlDocumentFragment类  包含一个或多个不带任何树结构的节点的临时段<br>DocumentType XmlDocumentType类    &lt;! DOCTYPE…&gt;节点<br>EntityReference XmlEntityReference类  非扩展的实体引用文本<br>Element XmlElement类 元素节点<br>Attr XmlAttribute类  元素的属性<br>ProcessingInstruction XmlProcessingInstruction类 处理指令节点<br>Comment XmlComment类 注释节点<br>Text XmlText类 属于某个元素或属性的文本<br>CDATASection XmlCDataSection类 CDATA<br>Entity XmlEntity类 XML文档(来自内部文档类型定义(DTD)子集或来自外部DTD和参数实体)中的&lt;!ENTITY…&gt;声明<br>Notation XmlNotation类 DTD中声明的表示法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line"> &lt;PivotItem Header=<span class="string">&quot;Xml&quot;</span>&gt;</span><br><span class="line">                &lt;Grid Background=<span class="string">&quot;&#123;ThemeResource ApplicationPageBackgroundThemeBrush&#125;&quot;</span>&gt;</span><br><span class="line">                    &lt;Grid x:Name=<span class="string">&quot;ContentPanelShop&quot;</span> Margin=<span class="string">&quot;12,0,12,0&quot;</span>&gt;</span><br><span class="line">                        &lt;!--展示购物清单的列表--&gt;</span><br><span class="line">                        &lt;ListBox FontSize=<span class="string">&quot;48&quot;</span> x:Name=<span class="string">&quot;Files&quot;</span>&gt;</span><br><span class="line">                        &lt;/ListBox&gt;</span><br><span class="line">                    &lt;/Grid&gt;</span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line">            &lt;/PivotItem&gt;</span><br><span class="line">        &lt;/Pivot&gt;</span><br><span class="line"> &lt;AppBarButton Label=<span class="string">&quot;新增&quot;</span> Icon=<span class="string">&quot;Add&quot;</span> Click=<span class="string">&quot;AppBarButton_Click_1&quot;</span>/&gt;</span><br><span class="line"> //加载页面触发Loaded事件</span><br><span class="line">            Loaded += BlankPage_Loaded;</span><br><span class="line">  private async void BlankPage_Loaded(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Files.Items.Clear();</span><br><span class="line">            //获取应用程序的本地存储文件</span><br><span class="line">            StorageFolder storage = await ApplicationData.Current.LocalFolder.CreateFolderAsync(<span class="string">&quot;ShoppingList&quot;</span>,CreationCollisionOption.OpenIfExists);</span><br><span class="line">            var files = await storage.GetFilesAsync();</span><br><span class="line">            &#123;</span><br><span class="line">                //获取购物清单文件夹里面存储的文件</span><br><span class="line">                foreach (StorageFile file <span class="keyword">in</span> files) &#123;</span><br><span class="line">                    //动态构建一个Grid</span><br><span class="line">                    Grid a = new Grid();</span><br><span class="line">                    //定义第一列</span><br><span class="line">                    ColumnDefinition col = new ColumnDefinition();</span><br><span class="line">                    col.Width = GridLength.Auto;</span><br><span class="line">                    a.ColumnDefinitions.Add(col);</span><br><span class="line"></span><br><span class="line">                    //定义第二列</span><br><span class="line">                    ColumnDefinition col2 = new ColumnDefinition();</span><br><span class="line">                    col2.Width = GridLength.Auto;</span><br><span class="line">                    a.ColumnDefinitions.Add(col2);</span><br><span class="line">                    //添加一个TextBlock现实文件名到第一列</span><br><span class="line">                    TextBlock txbx = new TextBlock();</span><br><span class="line">                    txbx.Text = file.DisplayName;</span><br><span class="line">                    Grid.SetColumn(txbx,0);</span><br><span class="line">                    //添加一个HyperlinkButton链接到购物详细清单页面,这是第二列</span><br><span class="line">                    HyperlinkButton btn = new HyperlinkButton();</span><br><span class="line">                    btn.Content = <span class="string">&quot;查看详细&quot;</span>;</span><br><span class="line">                    btn.Name = file.DisplayName;</span><br><span class="line">                    btn.Click += (s,ea)=&gt; &#123;</span><br><span class="line">                        Frame.Navigate(typeof(DisplayPage), file);</span><br><span class="line">                    &#125;;</span><br><span class="line">                    Grid.SetColumn(btn,1);</span><br><span class="line">                    a.Children.Add(txbx);</span><br><span class="line">                    a.Children.Add(btn);</span><br><span class="line">                    Files.Items.Add(a);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">        /// </span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public void <span class="function"><span class="title">SaveAsXml</span></span>() &#123;</span><br><span class="line">            //创建一个XmlDocument对象代表着是一个Xml的文档对象.</span><br><span class="line">            XmlDocument dom = new XmlDocument();</span><br><span class="line">            //创建和添加一条XML的评论</span><br><span class="line">            XmlComment dec = dom.CreateComment(<span class="string">&quot;THis is Students Message.&quot;</span>);</span><br><span class="line">            dom.AppendChild(dec);</span><br><span class="line"></span><br><span class="line">            //添加一个students的元素为Xml文档的根元素</span><br><span class="line">            XmlElement x = dom.CreateElement(<span class="string">&quot;studetns&quot;</span>);</span><br><span class="line">            dom.AppendChild(x);</span><br><span class="line">            //创建一个Student元素后面再添加到students元素的节点上</span><br><span class="line">            XmlElement x1 = dom.CreateElement(<span class="string">&quot;Student&quot;</span>);</span><br><span class="line">            //在Student元素里再添加<span class="built_in">id</span>和name两个元素节点,在节点内还添加了文本内容</span><br><span class="line">            XmlElement x11 = dom.CreateElement(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            x11.InnerText = <span class="string">&quot;id001&quot;</span>;</span><br><span class="line">            x1.AppendChild(x11);</span><br><span class="line">            XmlElement x12 = dom.CreateElement(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            x12.InnerText = <span class="string">&quot;张三&quot;</span>;</span><br><span class="line">            x1.AppendChild(x12);</span><br><span class="line">            x.AppendChild(x1);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void AppBarButton_Click_1(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            Frame.Navigate(typeof(AddItem));</span><br><span class="line">        &#125;</span><br><span class="line">AddItem.xaml .cs</span><br><span class="line">&lt;Page</span><br><span class="line">    x:Class=<span class="string">&quot;App1.AddItem&quot;</span></span><br><span class="line">    xmlns=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span><br><span class="line">    xmlns:x=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span></span><br><span class="line">    xmlns:<span class="built_in">local</span>=<span class="string">&quot;using:App1&quot;</span></span><br><span class="line">    xmlns:d=<span class="string">&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span></span><br><span class="line">    xmlns:mc=<span class="string">&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span></span><br><span class="line">    mc:Ignorable=<span class="string">&quot;d&quot;</span></span><br><span class="line">    Background=<span class="string">&quot;&#123;ThemeResource ApplicationPageBackgroundThemeBrush&#125;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Grid&gt;</span><br><span class="line">        &lt;Grid x:Name=<span class="string">&quot;ContentPanel&quot;</span> Margin=<span class="string">&quot;12,0,12,0&quot;</span>&gt;</span><br><span class="line">            &lt;Grid.RowDefinitions&gt;</span><br><span class="line">                &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">                &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">                &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">                &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">            &lt;/Grid.RowDefinitions&gt;</span><br><span class="line">            &lt;Grid.ColumnDefinitions&gt;</span><br><span class="line">                &lt;ColumnDefinition Width=<span class="string">&quot;100*&quot;</span>/&gt;</span><br><span class="line">                &lt;ColumnDefinition Width=<span class="string">&quot;346*&quot;</span>/&gt;</span><br><span class="line">            &lt;/Grid.ColumnDefinitions&gt;</span><br><span class="line">            &lt;TextBlock Grid.Column=<span class="string">&quot;0&quot;</span> Grid.Row=<span class="string">&quot;0&quot;</span> Text=<span class="string">&quot;名称:&quot;</span></span><br><span class="line">                       HorizontalAlignment=<span class="string">&quot;Center&quot;</span> VerticalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBox Name=<span class="string">&quot;nameTxt&quot;</span> Grid.Column=<span class="string">&quot;1&quot;</span> Grid.Row=<span class="string">&quot;0&quot;</span> MaxHeight=<span class="string">&quot;40&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBlock Grid.Column=<span class="string">&quot;0&quot;</span> Grid.Row=<span class="string">&quot;1&quot;</span> Text=<span class="string">&quot;价格:&quot;</span> HorizontalAlignment=<span class="string">&quot;Center&quot;</span> VerticalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBox x:Name=<span class="string">&quot;priceTxt&quot;</span> Grid.Column=<span class="string">&quot;1&quot;</span> Grid.Row=<span class="string">&quot;1&quot;</span> MaxHeight=<span class="string">&quot;40&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBlock Grid.Row=<span class="string">&quot;2&quot;</span> Grid.Column=<span class="string">&quot;0&quot;</span> Text=<span class="string">&quot;数量:&quot;</span></span><br><span class="line">                       HorizontalAlignment=<span class="string">&quot;Center&quot;</span> VerticalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBox Name=<span class="string">&quot;quanTxt&quot;</span> Grid.Column=<span class="string">&quot;1&quot;</span> Grid.Row=<span class="string">&quot;2&quot;</span> MaxHeight=<span class="string">&quot;40&quot;</span>/&gt;</span><br><span class="line">            &lt;Button x:Name=<span class="string">&quot;BtnSave&quot;</span> Content=<span class="string">&quot;保存&quot;</span> HorizontalAlignment=<span class="string">&quot;Stretch&quot;</span> Grid.Row=<span class="string">&quot;3&quot;</span> Grid.ColumnSpan=<span class="string">&quot;2&quot;</span> VerticalAlignment=<span class="string">&quot;Top&quot;</span> Click=<span class="string">&quot;BtnSave_Click&quot;</span>/&gt;</span><br><span class="line">            </span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">    &lt;/Grid&gt;</span><br><span class="line">&lt;/Page&gt;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Runtime.InteropServices.WindowsRuntime;</span><br><span class="line">using Windows.Data.Xml.Dom;</span><br><span class="line">using Windows.Foundation;</span><br><span class="line">using Windows.Foundation.Collections;</span><br><span class="line">using Windows.Storage;</span><br><span class="line">using Windows.UI.Xaml;</span><br><span class="line">using Windows.UI.Xaml.Controls;</span><br><span class="line">using Windows.UI.Xaml.Controls.Primitives;</span><br><span class="line">using Windows.UI.Xaml.Data;</span><br><span class="line">using Windows.UI.Xaml.Input;</span><br><span class="line">using Windows.UI.Xaml.Media;</span><br><span class="line">using Windows.UI.Xaml.Navigation;</span><br><span class="line"></span><br><span class="line">// https://go.microsoft.com/fwlink/?LinkId=234238 上介绍了“空白页”项模板</span><br><span class="line"></span><br><span class="line">namespace App1</span><br><span class="line">&#123;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 可用于自身或导航至 Frame 内部的空白页。</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public sealed partial class AddItem : Page</span><br><span class="line">    &#123;</span><br><span class="line">        public <span class="function"><span class="title">AddItem</span></span>()</span><br><span class="line">        &#123;</span><br><span class="line">            this.InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private async void BtnSave_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            //获取购物清单的文件夹对象</span><br><span class="line">            StorageFolder storage = await ApplicationData.Current.LocalFolder.GetFolderAsync(<span class="string">&quot;ShoppingList&quot;</span>);</span><br><span class="line">            //创建一个Xml的对象,示例格式如&lt;Apple pric=<span class="string">&quot;23&quot;</span> quantity=<span class="string">&quot;3&quot;</span>/&gt;</span><br><span class="line">            XmlDocument _doc= new XmlDocument();</span><br><span class="line">            //使用商品的名称来创建一个xml元素作为根节点</span><br><span class="line">            XmlElement _item=_doc.CreateElement(nameTxt.Text);</span><br><span class="line">            //使用属性来作为信息的标识符,用属性的值来存储相关的信息</span><br><span class="line">            _item.SetAttribute(<span class="string">&quot;price&quot;</span>, priceTxt.Text);</span><br><span class="line">            _item.SetAttribute(<span class="string">&quot;quantity&quot;</span>,quanTxt.Text);</span><br><span class="line">            _doc.AppendChild(_item);</span><br><span class="line">            //创建一个应用文件</span><br><span class="line">            StorageFile file = await storage.CreateFileAsync(nameTxt.Text+<span class="string">&quot;.xml&quot;</span>,CreationCollisionOption.ReplaceExisting);</span><br><span class="line">            //把XML的信息保存到文件中去</span><br><span class="line">            await _doc.SaveToFileAsync(file);</span><br><span class="line">            //调回清单主页</span><br><span class="line">            Frame.GoBack();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">DisplayPage.xaml .cs</span><br><span class="line">&lt;Page</span><br><span class="line">    x:Class=<span class="string">&quot;App1.DisplayPage&quot;</span></span><br><span class="line">    xmlns=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml/presentation&quot;</span></span><br><span class="line">    xmlns:x=<span class="string">&quot;http://schemas.microsoft.com/winfx/2006/xaml&quot;</span></span><br><span class="line">    xmlns:<span class="built_in">local</span>=<span class="string">&quot;using:App1&quot;</span></span><br><span class="line">    xmlns:d=<span class="string">&quot;http://schemas.microsoft.com/expression/blend/2008&quot;</span></span><br><span class="line">    xmlns:mc=<span class="string">&quot;http://schemas.openxmlformats.org/markup-compatibility/2006&quot;</span></span><br><span class="line">    mc:Ignorable=<span class="string">&quot;d&quot;</span></span><br><span class="line">    Background=<span class="string">&quot;&#123;ThemeResource ApplicationPageBackgroundThemeBrush&#125;&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Grid x:Name=<span class="string">&quot;ContentPanel&quot;</span> Margin=<span class="string">&quot;12,0,12,0&quot;</span>&gt;</span><br><span class="line">        &lt;Grid.RowDefinitions&gt;</span><br><span class="line">            &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">            &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">            &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">            &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">        &lt;/Grid.RowDefinitions&gt;</span><br><span class="line">        &lt;Grid.ColumnDefinitions&gt;</span><br><span class="line">            &lt;ColumnDefinition Width=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">            &lt;ColumnDefinition Width=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">        &lt;/Grid.ColumnDefinitions&gt;</span><br><span class="line">      </span><br><span class="line">            &lt;TextBlock Grid.Column=<span class="string">&quot;0&quot;</span> Grid.Row=<span class="string">&quot;0&quot;</span> Text=<span class="string">&quot;名称:&quot;</span></span><br><span class="line">                       HorizontalAlignment=<span class="string">&quot;Center&quot;</span> VerticalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBlock x:Name=<span class="string">&quot;nameTxt&quot;</span> Grid.Column=<span class="string">&quot;1&quot;</span> Grid.Row=<span class="string">&quot;0&quot;</span> FontSize=<span class="string">&quot;30&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextBlock Grid.Row=<span class="string">&quot;1&quot;</span> Text=<span class="string">&quot;价格:&quot;</span> HorizontalAlignment=<span class="string">&quot;Center&quot;</span> VerticalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBlock x:Name=<span class="string">&quot;priceTxt&quot;</span> Grid.Column=<span class="string">&quot;1&quot;</span> Grid.Row=<span class="string">&quot;1&quot;</span> FontSize=<span class="string">&quot;30&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">            &lt;TextBlock Grid.Column=<span class="string">&quot;0&quot;</span> Grid.Row=<span class="string">&quot;2&quot;</span> Text=<span class="string">&quot;数量:&quot;</span></span><br><span class="line">                       HorizontalAlignment=<span class="string">&quot;Center&quot;</span> VerticalAlignment=<span class="string">&quot;Center&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBlock Name=<span class="string">&quot;quanTxt&quot;</span> Grid.Column=<span class="string">&quot;1&quot;</span> Grid.Row=<span class="string">&quot;2&quot;</span> FontSize=<span class="string">&quot;30&quot;</span>/&gt;</span><br><span class="line">            &lt;TextBlock Name=<span class="string">&quot;PageTitle&quot;</span> Grid.Row=<span class="string">&quot;3&quot;</span>/&gt;</span><br><span class="line">        &lt;/Grid&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/Page&gt;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Runtime.InteropServices.WindowsRuntime;</span><br><span class="line">using Windows.Data.Xml.Dom;</span><br><span class="line">using Windows.Foundation;</span><br><span class="line">using Windows.Foundation.Collections;</span><br><span class="line">using Windows.Storage;</span><br><span class="line">using Windows.UI.Xaml;</span><br><span class="line">using Windows.UI.Xaml.Controls;</span><br><span class="line">using Windows.UI.Xaml.Controls.Primitives;</span><br><span class="line">using Windows.UI.Xaml.Data;</span><br><span class="line">using Windows.UI.Xaml.Input;</span><br><span class="line">using Windows.UI.Xaml.Media;</span><br><span class="line">using Windows.UI.Xaml.Navigation;</span><br><span class="line"></span><br><span class="line">// https://go.microsoft.com/fwlink/?LinkId=234238 上介绍了“空白页”项模板</span><br><span class="line"></span><br><span class="line">namespace App1</span><br><span class="line">&#123;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">    /// 可用于自身或导航至 Frame 内部的空白页。</span><br><span class="line">    /// &lt;/summary&gt;</span><br><span class="line">    public sealed partial class DisplayPage : Page</span><br><span class="line">    &#123;</span><br><span class="line">        public <span class="function"><span class="title">DisplayPage</span></span>()</span><br><span class="line">        &#123;</span><br><span class="line">            this.InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected override async void OnNavigatedTo(NavigationEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">           //获取上一个清单列表传递过来的参数,该参数是一个StorageFile对象.</span><br><span class="line">           StorageFile file=e.Parameter as StorageFile;</span><br><span class="line">            <span class="keyword">if</span> (file == null) <span class="built_in">return</span>;</span><br><span class="line">            //获取文件的名字</span><br><span class="line">            string itemName = file.DisplayName;</span><br><span class="line">            PageTitle.Text = itemName;</span><br><span class="line">            //把应用文件作为一个xml文档加载进来</span><br><span class="line">            XmlDocument doc=await XmlDocument.LoadFromFileAsync(file);</span><br><span class="line">            //获取xml文档的信息</span><br><span class="line">            priceTxt.Text = doc.DocumentElement.Attributes.GetNamedItem(<span class="string">&quot;price&quot;</span>).NodeValue.ToString();</span><br><span class="line">            quanTxt.Text = doc.DocumentElement.Attributes.GetNamedItem(<span class="string">&quot;quantity&quot;</span>).NodeValue.ToString();</span><br><span class="line">            nameTxt.Text = itemName;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6.4.安装包文件数据<br>可以在应用程序里获取安装包下的文件,就是在应用程序项目中添加的文件.编译文件源代码和资源文件是获取不到的.安装包文件数据和应用文件应用设置所存储的位置是不一样的,如果是保存应用程序业务的相关信息不建议保存到安装包的目录下,安装包文件数据通常是用于内置一些固定的文件数据.<br>6.41.安装包文件访问<br>获取安装包的文件可以先通过Windows.ApplicationModel.Package类的InstalledLocation属性来获取安装包的文件夹.<br>StorageFolder localFolder=Windows.ApplicationModel.Package.Current.InstalledLocation;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"> &lt;PivotItem Header=<span class="string">&quot;ApplicationModelPackage&quot;</span>&gt;</span><br><span class="line">                &lt;ScrollViewer&gt;</span><br><span class="line">                    &lt;StackPanel&gt;</span><br><span class="line">                        &lt;Button Content=<span class="string">&quot;获取安装包的根目录&quot;</span> x:Name=<span class="string">&quot;btnGetFile&quot;</span> Click=<span class="string">&quot;btnGetFile_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line">                        &lt;TextBlock Text=<span class="string">&quot;文件夹列表:&quot;</span>/&gt;</span><br><span class="line">                        &lt;ListBox x:Name=<span class="string">&quot;lbFolder&quot;</span>/&gt;</span><br><span class="line">                        &lt;Button Content=<span class="string">&quot;打开选中的文件夹&quot;</span> x:Name=<span class="string">&quot;open&quot;</span> Click=<span class="string">&quot;open_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;TextBlock Text=<span class="string">&quot;文件列表:&quot;</span>/&gt;</span><br><span class="line">                        &lt;ListBox x:Name=<span class="string">&quot;lbFile&quot;</span>&gt;</span><br><span class="line">                        &lt;/ListBox&gt;</span><br><span class="line">                        &lt;Button Content=<span class="string">&quot;在选中文件夹下创建测试文件&quot;</span> x:Name=<span class="string">&quot;create&quot;</span> Click=<span class="string">&quot;create_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line">                        &lt;Button Content=<span class="string">&quot;删除选中的文件&quot;</span> x:Name=<span class="string">&quot;delete&quot;</span> Click=<span class="string">&quot;delete_Click&quot;</span> Margin=<span class="string">&quot;2&quot;</span>/&gt;</span><br><span class="line">                        </span><br><span class="line">                    &lt;/StackPanel&gt;</span><br><span class="line">                &lt;/ScrollViewer&gt;</span><br><span class="line">            &lt;/PivotItem&gt;</span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">        /// 打开应用程序的根目录</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void btnGetFile_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            //清理文件夹列表</span><br><span class="line">            lbFolder.Items.Clear();</span><br><span class="line">            //获取根目录</span><br><span class="line">            StorageFolder localFolder =Windows.ApplicationModel.Package. Current.InstalledLocation;</span><br><span class="line">            //添加遍历根目录的文件夹到文件夹列表</span><br><span class="line">            foreach (var folder <span class="keyword">in</span> await localFolder.GetFoldersAsync())</span><br><span class="line">            &#123;</span><br><span class="line">                ListBoxItem item = new ListBoxItem();</span><br><span class="line">                item.Content = <span class="string">&quot;应用程序目录:&quot;</span> + folder.Name;</span><br><span class="line">                item.DataContext = folder;</span><br><span class="line">                lbFolder.Items.Add(item);</span><br><span class="line">            &#125;</span><br><span class="line">            //清理文件列表</span><br><span class="line">            lbFile.Items.Clear();</span><br><span class="line">            //添加遍历根目录的文件到文件列表</span><br><span class="line">            foreach (var file <span class="keyword">in</span> await localFolder.GetFilesAsync())</span><br><span class="line">            &#123;</span><br><span class="line">                ListBoxItem item3 = new ListBoxItem();</span><br><span class="line">                item3.Content = <span class="string">&quot;文件:&quot;</span> + file.Name;</span><br><span class="line">                item3.DataContext = file;</span><br><span class="line">                lbFile.Items.Add(item3);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 打开选中的文件夹</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void open_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (lbFolder.SelectedIndex == -1) &#123;</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;请选择一个文件夹&quot;</span>).ShowAsync();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ListBoxItem item = lbFolder.SelectedItem as ListBoxItem;</span><br><span class="line">                //获取选中的文件夹</span><br><span class="line">                StorageFolder folder = item.DataContext as StorageFolder;</span><br><span class="line">                //清理文件夹列表</span><br><span class="line">                lbFolder.Items.Clear();</span><br><span class="line">                //添加遍历到的文件夹到文件夹列表</span><br><span class="line">                foreach (var folder2 <span class="keyword">in</span> await folder.GetFoldersAsync())</span><br><span class="line">                &#123;</span><br><span class="line">                    ListBoxItem item2 = new ListBoxItem();</span><br><span class="line">                    item2.Content = <span class="string">&quot;文件夹:&quot;</span> + folder2.Name;</span><br><span class="line">                    item2.DataContext = folder;</span><br><span class="line">                    lbFolder.Items.Add(item2);</span><br><span class="line">                &#125;</span><br><span class="line">                //清理文件列表</span><br><span class="line">                lbFile.Items.Clear();</span><br><span class="line">                //添加遍历到的文件到文件列表</span><br><span class="line">                foreach (var file <span class="keyword">in</span> await folder.GetFilesAsync())</span><br><span class="line">                &#123;</span><br><span class="line">                    ListBoxItem item3 = new ListBoxItem();</span><br><span class="line">                    item3.Content = <span class="string">&quot;文件:&quot;</span> + file.Name;</span><br><span class="line">                    item3.DataContext = file;</span><br><span class="line">                    lbFile.Items.Add(item3);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 在选中的文件中新建一个文件</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void create_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (lbFolder.SelectedIndex == -1)</span><br><span class="line">            &#123;</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;请选择一个文件夹&quot;</span>).ShowAsync();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                ListBoxItem item = lbFolder.SelectedItem as ListBoxItem;</span><br><span class="line">                //获取选中的文件夹</span><br><span class="line">                StorageFolder folder=item.DataContext as StorageFolder;</span><br><span class="line">                //在文件夹中创建一个文件</span><br><span class="line">                StorageFile file = await folder.CreateFileAsync(DateTime.Now.Millisecond.ToString()+<span class="string">&quot;.txt&quot;</span>);</span><br><span class="line">                //添加到文件列表中</span><br><span class="line">                ListBoxItem item3 = new ListBoxItem();</span><br><span class="line">                item3.Content = <span class="string">&quot;文件:&quot;</span> + file.Name;</span><br><span class="line">                item3.DataContext= file;</span><br><span class="line">                lbFile.Items.Add(item3);</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;创建文件成功&quot;</span>).ShowAsync();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 删除选中的文件</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        private async void delete_Click(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (lbFile.SelectedIndex == -1) &#123;</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;请选择一个文件夹&quot;</span>).ShowAsync();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ListBoxItem item=lbFile.SelectedItem as ListBoxItem;</span><br><span class="line">                //获取选中的文件</span><br><span class="line">                StorageFile file=item.DataContext as StorageFile; </span><br><span class="line">                //删除文件</span><br><span class="line">                await file.DeleteAsync();</span><br><span class="line">                lbFile.Items.Remove(item);</span><br><span class="line">                await new MessageDialog(<span class="string">&quot;删除成功&quot;</span>).ShowAsync();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>6.42 安装包文件的URI方案<br>应用文件可以通过URI来访问,安装包的文件也一样可以通过URI来访问,不过两者之间的URI方案是有区别的,应用文件使用的是以字符串”ms-appdata:///“开头的URI地址,而安装包使用的是”ms-appx:///“.例如获取安装包PackageTest文件夹下的test.xml:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var file=await Windows.Storage.StorageFile.GetFileFromApplicationUriAsync(new Uri(<span class="string">&quot;ms-appx:///PackageTest/test.xml&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>如果是图片文件也可以直接在XAML上给Image控件的Source属性赋值<br>1.访问存储在本地文件夹中的文件:<Image Source="ms-appdata:///local/images/logo.png"/><br>2.访问存储在漫游文件夹中的文件:<Image Source="ms-appdata:///roaming/images/logo.png"/><br>3.访问存储在临时文件夹中的文件:<Image Source="ms-appdata:///temp/images/logo.png"/><br>4.访问安装包文件夹中的文件:<Image Source="ms-appx:///images/logo.png"/>或者<Image Source="/images/logo.png"/><br>下面给出访问应用文件夹和安装包文件夹图片文件的示例:打开示例程序会先将安装包的一个程序图标文件复制到应用文件夹里,然后通过两种不同的URI方案来给Image控件添加图片资源.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;AppUri&quot;</span>&gt;</span><br><span class="line">               &lt;StackPanel&gt;</span><br><span class="line">                   &lt;TextBlock Text=<span class="string">&quot;安装包的图片展示:&quot;</span>/&gt;</span><br><span class="line">                   &lt;Image x:Name=<span class="string">&quot;packageImage&quot;</span> Height=<span class="string">&quot;200&quot;</span>/&gt;</span><br><span class="line">                   &lt;TextBlock Text=<span class="string">&quot;应用存储的图片展示:&quot;</span>/&gt;</span><br><span class="line">                   &lt;Image x:Name=<span class="string">&quot;appImage&quot;</span> Height=<span class="string">&quot;200&quot;</span>/&gt;</span><br><span class="line">               &lt;/StackPanel&gt;</span><br><span class="line">           &lt;/PivotItem&gt;</span><br><span class="line">protected override async void OnNavigatedTo(NavigationEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           ApplicationData appData = ApplicationData.Current;</span><br><span class="line">           //将程序包内的文件保存到应用存储中的TemporaryFolder</span><br><span class="line">           StorageFile imgFile = await StorageFile.GetFileFromApplicationUriAsync(new Uri(<span class="string">&quot;ms-appx:///Assets/LockScreenLogo.scale-200.png&quot;</span>));</span><br><span class="line">           await imgFile.CopyAsync(appData.TemporaryFolder,imgFile.Name,NameCollisionOption.ReplaceExisting);</span><br><span class="line">           //引用应用存储内的图片文件并显示</span><br><span class="line">           appImage.Source = new BitmapImage(new Uri(<span class="string">&quot;ms-appdata:///temp/LockScreenLogo.scale-200.png&quot;</span>));</span><br><span class="line">           //引用程序包内的图片文件并显示</span><br><span class="line">           packageImage.Source = new BitmapImage(new Uri(<span class="string">&quot;ms-appx:///Assets/LockScreenLogo.scale-200.png&quot;</span>));</span><br><span class="line"></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<h4 id="图形绘图"><a href="#图形绘图" class="headerlink" title="图形绘图"></a>图形绘图</h4><p>7.11.图形中常用的结构.<br>在图形中经常用到Point,Size,Rect和Color这些数据结构,常用于对图形形状的相关属性赋值<br>1.Point结构.<br>Windows.Foundation.Point定义点的位置.<br>public Point(double x,double y)<br>2.Size结构<br>public Size(double width,double height)<br>3.Rect结构<br>矩形Rect Windows.Foundation.Rect</p>
<p>1.属性X,Y:矩形结构左上角的x,y坐标.<br>2.只读属性Left,Top:矩形结构左上角的x,y坐标.<br>3.只读属性Right和Bottom:矩形结构对象右下角的x,y坐标<br>4.属性Width,Height,Size矩形结构对象的宽度和高度.<br>5.构造函数Rect(Point location,Size size) 参数1代表矩形结构左上角点结构,参数2代表矩形宽和高的Size结构.<br>6.构造函数Rect(Double x,Double y,Double width,Double height):参数依次为矩形左上角x坐标,y坐标,宽和高.<br>7.方法public void Intersect(Rect rect) 得到调用该方法的矩形结构对象和参数表示的矩形结构的交集</p>
<p>4.Color结构<br>Windows.UI.Color. a,b,r,g 透明度,蓝色,绿色,红色合成.Color结构支持两种色彩空间sRGB和scRGB.<br>sRGB用无符号32位数代表一种颜色,红色,绿色,蓝色以及透明度各占一个字节,透明度等于0为完全透明,255为完全不透明.例如完全不透明红色用16进制数表示为#ffff0000,scRGB代表的颜色中的红色,绿色，蓝色以及透明度分别用0-1之间的Sing类型数表示,透明度等于0.0为完全透明,1.0为完全不透明.红色,绿色,蓝色全为0.0 表示黑色,全为1.0表示白色.例如不透明红色表示为sc#1.0,1.0,0.0,0.0,其常用属性和方法如下:<br>public static Color FromArgb(byte a,byte r,byte g,byte b):sRGB颜色.<br>7.12.画图相关的类<br>有两组类可用于定义空间的区域:Shape和Geometry.主要区别是:Shape拥有与之关联的画笔并可以呈现到屏幕,但Geometry只定义空间的区域并且不会呈现.可以认为Shape是由Geometry定义的有边界的UIElement,<br>Shape类 有 画线段类Line,Rectangle类,Ellipse,多条线段类Polyline,画由多条线段组成的闭合图形类Polygon,Path.Windows.UI.Xaml.Shapes.Shape<br>1.Fill 填充的画刷 Winodws.UI.Xaml.Media.Brush类型<br>2.Stroke 表示笔触 图形的边界颜色 Windows.UI.Xaml.Media.Brush类型<br>3.StrokeThickness 笔触尺寸.可以理解为图形边界大小.<br>4.Stretch None Fill Uniform UniformToFill<br>5.StrokeDashArray 表示虚线和间隙值的集合,用于画虚线,StrokeDashArray参数采用S[,G][,S*,G**]*的形式,其中S表示笔画的长度值,G表示间隙的长度值,如果忽略了G,则间隙长度与前一个笔画长度相同,例如线宽=1，”2”表示2个像素的实线和2个像素的空白组成的虚线,”3,2”表示3个像素实线和2个像素空白组成的虚线,<br>“2,2,3,2”表示2个像素的实线和2个像素的空白+3个像素的实线和2个像素的空白(如此反复)组成的虚线.<br>实际实线和空白间隔像素还受线宽的影响.<br>6.StrokeDashCap:表示虚线两端(线帽)的类型,用于画虚线(Windows.UI.Xaml.Media.PenLineCap枚举类型)<br>PenLineCap是描述直线或线段末端的形状,枚举值Flat表示一个未超出直线上最后一点的线帽,等同于无线帽,<br>Square表示一个高度等于直线粗细,长度等于直线粗细一半的矩形,Round表示一个直径等于直线粗细的半圆形;Triangle表示一个底边长度等于直线粗细的等腰直角三角形.<br>7.StrokeStartLineCap:虚线起始端(线帽)的类型(Windows.UI.Xaml.Media.PenLineCap枚举类型)<br>8.StrokeEndLineCap:虚线终结端(线帽)的类型<br>9.StrokeDashOffset:虚线的起始位置,用于画虚线,从虚线的起始端的StrokeDashOffset距离处开始描绘虚线.<br>10.StrokeLineJoin:图形连接点处的连接类型(Windows.UI.Xaml.Media.PenLineJoin枚举类型)<br>PenLineJoin是描述连接两条线或线段的形状的枚举类型—Miter表示线条连接使用常规角顶点;Bevel表示线条连接使用斜角顶点.Round表示线条连接使用圆角顶点.<br>11.StrokeMiterLimit:斜接长度与StrokeThickness/2的比值.默认值为10,最小值为1.<br>7.13.基础的图形形状<br>1.Line线段<br>控件Line来画线段,X1 Y1 起点 X2 Y2 终点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Line X1=<span class="string">&quot;0&quot;</span> Y1=<span class="string">&quot;0&quot;</span> X2=<span class="string">&quot;100&quot;</span> Y2=<span class="string">&quot;100&quot;</span> Stroke=<span class="string">&quot;Black&quot;</span> StrokeThickness=<span class="string">&quot;10&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>2.Rectangle矩形<br>控件Rectangle可用来画各种矩形,属性Width,Height,RadiusX和RadiusY分别是矩形的宽,高,圆角矩形的圆角x轴半径和y轴半径.x轴半径要小于等于Width二分之一,y轴半径要小于等于height二分之一,当二者都等于二分之一,则圆形变为圆或椭圆.<br><Rectangle Width="200" height="100" Fill="Blue" RadiusX="20" RadiusY="20"/><br>3.Ellipse椭圆<br>控件Ellipse画椭圆时,如果Width=height,则为圆.<br><Ellipse Stroke="Blue" Fill="Red" Width="100" height="100" StrokeThickness="8"/><br>4.Polyline开放多边形和Polygon封闭多边形<br>Polyline类属性Ponints是点结构数组,将数组元素Ponints[0]和Ponints[1],Ponints[1]和Ponints[2],等点连接为多条线段 设置类Polyline属性IsClose=true 也能完成Polygon类相同功能.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Polyline Points=<span class="string">&quot;10,110 60,10 110,110&quot;</span> Stroke=<span class="string">&quot;Red&quot;</span> StrokeThickness=<span class="string">&quot;4&quot;</span>/&gt;</span><br><span class="line">&lt;Polygon Points=<span class="string">&quot;10,110 60,10,110,110&quot;</span> Stroke=<span class="string">&quot;Red&quot;</span> StrokeThickness=<span class="string">&quot;4&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>实现更高的灵活化,采用Line去实现画图的功能.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;Line&quot;</span>&gt;</span><br><span class="line">                &lt;Canvas x:Name=<span class="string">&quot;ContentPanelCanvas&quot;</span> Background=<span class="string">&quot;Transparent&quot;</span>&gt;</span><br><span class="line">                </span><br><span class="line">                &lt;/Canvas&gt;</span><br><span class="line">            &lt;/PivotItem&gt;</span><br><span class="line"></span><br><span class="line"> //注册画图的指针移动事件,用来捕获手指在设备屏幕上的点</span><br><span class="line">            this.ContentPanelCanvas.PointerMoved += ContentPanelCanvas_PointerMoved;</span><br><span class="line">            //注册指针按下事件,用来记录第一个触摸点</span><br><span class="line">            this.ContentPanelCanvas.PointerPressed += ContentPanelCanvas_PointerPressed;</span><br><span class="line">    /// &lt;summary&gt;</span><br><span class="line">        /// 指针按下事件</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;exception cref=<span class="string">&quot;NotImplementedException&quot;</span>&gt;&lt;/exception&gt;</span><br><span class="line">        private void ContentPanelCanvas_PointerPressed(object sender, PointerRoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            currentPoint = e.GetCurrentPoint(ContentPanelCanvas).Position;</span><br><span class="line">            oldPoint= currentPoint;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private void ContentPanelCanvas_PointerMoved(object sender, PointerRoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            ///获取相对于画布控件的点坐标</span><br><span class="line">            currentPoint=e.GetCurrentPoint(ContentPanelCanvas).Position;</span><br><span class="line">            //根据上一个画图的点和当前的画图的点新建一条线段</span><br><span class="line">            Line line = new <span class="function"><span class="title">Line</span></span>() &#123; X1=currentPoint.X,Y1=currentPoint.Y,X2=oldPoint.X,Y2=oldPoint.Y&#125;;</span><br><span class="line">            //设置线段的相关属性</span><br><span class="line">            line.Stroke = new SolidColorBrush(Colors.Red);</span><br><span class="line">            line.StrokeThickness = 5;</span><br><span class="line">            line.StrokeLineJoin = PenLineJoin.Round;</span><br><span class="line">            line.StrokeStartLineCap= PenLineCap.Round;</span><br><span class="line">            line.StrokeEndLineCap= PenLineCap.Round;</span><br><span class="line">            //把线段添加到画布面板上</span><br><span class="line">            this.ContentPanelCanvas.Children.Add(line);</span><br><span class="line">            //把当前的画图的点作为上一个画图的点</span><br><span class="line">            oldPoint= currentPoint;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>7.2 Path图形<br>7.21.两种Path图形的创建方法<br>最重要的属性是Data,Data的数据类型是Geometry(几何图形),正是使用这个属性将一些基本的线段拼接起来,形成复杂的图形.Data属性赋值的方法有两种,一种是使用Geometry图形绘制的标准语法;另一种是专门用于绘制几何图形的”路径标记语法”.用Geometry图形实现的Path图形显得更加直观.用路径标记语法则显得更加简洁.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Path Fill=<span class="string">&quot;Gold&quot;</span> Stroke=<span class="string">&quot;Black&quot;</span> StrokeThickness=<span class="string">&quot;1&quot;</span>&gt;</span><br><span class="line">	&lt;Path.Data&gt;</span><br><span class="line">		&lt;RectangleGeometry Rect=<span class="string">&quot;0,0,100,100&quot;</span>/&gt;</span><br><span class="line">	&lt;/Path.Data&gt;</span><br><span class="line">&lt;/Path&gt;</span><br><span class="line">&lt;Path Data=<span class="string">&quot;M0,L100,0 L100,100 L0,100 z&quot;</span> Fill=<span class="string">&quot;Gold&quot;</span> Height=<span class="string">&quot;100&quot;</span> Strenth=<span class="string">&quot;Fill&quot;</span> Width=<span class="string">&quot;100&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>7.22.使用简单的几何图形来创建Path<br>使用Geometry来创建Path图形,是非常直观的语法,它最大的优点是不仅仅可以通过XAML实现,还可以使用C#代码创建,所以如果要动态地改变Path的形状就需要使用Geometry来创建Path图形.<br>Path的Data属性是Geometry类,但是Geometry类是一个抽象类,所以不可能在XAML中直接使用<Geometry>标签.可以使用Geometry的子类.Geometry的子类包括以下几种<br>1.LineGeometry:直线几何图形<br>2.RectangleGeometry:矩形几何图形<br>3.EllipseGeometry:椭圆几何图形<br>4.PathGeometry:路径几何图形,PathGeometry是Geometry中最灵活的,可以绘制任意的2D几何图形<br>5.GeometryGroup:由多个基本几何图形组合在一起,形成几何图形组.<br>定义空间的区域有Shape和Geometry两种类型.Shape类型就是前面所讲的Line,Rectangle,Ellipse类,<br>Geometry类型不仅仅可以用在Path的Data属性上,还可以用在UIElement的Clip属性上.<br>Geometry对象可以分为3个类别:简单几何图形,路径几何图形以及复合几何图形.<br>简单几何图形类包括LineGeometry,RectangleGeometry和EllipseGeometry.用于创建基本的几何形状,例如直线,矩形和圆.<br>1.LineGeometry 通过指定直线的起点和终点来定义.<br>2.RectangleGeometry 通过使用Rect结构来定义,该机构指定矩形的相对位置,高度和宽度.<br>3.EllipseGeometry 通过中心点,x半径和y半径来定义.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;Geometry&quot;</span>&gt;</span><br><span class="line">               &lt;StackPanel&gt;</span><br><span class="line">                   &lt;!--直线--&gt;</span><br><span class="line">                   &lt;Path Stroke=<span class="string">&quot;Red&quot;</span> StrokeThickness=<span class="string">&quot;2&quot;</span>&gt;</span><br><span class="line">                       &lt;Path.Data&gt;</span><br><span class="line">                           &lt;LineGeometry StartPoint=<span class="string">&quot;0,0&quot;</span> EndPoint=<span class="string">&quot;400,20&quot;</span>/&gt;</span><br><span class="line">                       &lt;/Path.Data&gt;</span><br><span class="line">                   &lt;/Path&gt;</span><br><span class="line">                   &lt;!--矩形路径--&gt;</span><br><span class="line">                   &lt;Path Fill=<span class="string">&quot;Red&quot;</span>&gt;</span><br><span class="line">                       &lt;Path.Data&gt;</span><br><span class="line">                           &lt;RectangleGeometry Rect=<span class="string">&quot;20,20,400,50&quot;</span>/&gt;</span><br><span class="line">                       &lt;/Path.Data&gt;</span><br><span class="line">                   &lt;/Path&gt;</span><br><span class="line">                   &lt;!--椭圆路径--&gt;</span><br><span class="line">                   &lt;Path Fill=<span class="string">&quot;Red&quot;</span>&gt;</span><br><span class="line">                       &lt;Path.Data&gt;</span><br><span class="line">                           &lt;!--&lt;GeometryGroup组合&gt;--&gt;</span><br><span class="line">                           &lt;GeometryGroup FillRule=<span class="string">&quot;EvenOdd&quot;</span>&gt;</span><br><span class="line">                               &lt;RectangleGeometry Rect=<span class="string">&quot;80,50,200,100&quot;</span>/&gt;</span><br><span class="line">                               &lt;EllipseGeometry Center=<span class="string">&quot;300,100&quot;</span> RadiusX=<span class="string">&quot;80&quot;</span> RadiusY=<span class="string">&quot;60&quot;</span>&gt;</span><br><span class="line">                                   </span><br><span class="line">                               &lt;/EllipseGeometry&gt;</span><br><span class="line">                           &lt;/GeometryGroup&gt;</span><br><span class="line">                       &lt;/Path.Data&gt;</span><br><span class="line">                   &lt;/Path&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;Path Fill=<span class="string">&quot;Red&quot;</span> StrokeThickness=<span class="string">&quot;3&quot;</span>&gt;</span><br><span class="line">                       &lt;Path.Data&gt;</span><br><span class="line">                           &lt;!--&lt;GeometryGroup组合&gt;--&gt;</span><br><span class="line">                           &lt;GeometryGroup FillRule=<span class="string">&quot;Nonzero&quot;</span>&gt;</span><br><span class="line">                               &lt;RectangleGeometry Rect=<span class="string">&quot;80,50,200,100&quot;</span>/&gt;</span><br><span class="line">                               &lt;EllipseGeometry Center=<span class="string">&quot;300,100&quot;</span> RadiusX=<span class="string">&quot;80&quot;</span> RadiusY=<span class="string">&quot;60&quot;</span>/&gt;</span><br><span class="line">                           &lt;/GeometryGroup&gt;</span><br><span class="line">                       &lt;/Path.Data&gt;</span><br><span class="line">                   &lt;/Path&gt;</span><br><span class="line">               &lt;/StackPanel&gt;</span><br><span class="line">           &lt;/PivotItem&gt;</span><br><span class="line">       &lt;/Pivot&gt;</span><br></pre></td></tr></table></figure>
<p>7.23.使用PathGeometry来创建Path<br>PathGeometry是Geometry里最灵活的几何图形,相当于Shape里面的Path一样,PathGeometry的核心是PathGeometry对象的集合,这些对象之所以这样命名是因为每个图形都描绘PathGeometry中的一个离散状态,每个PathFigure自身又由一个或多个PathSegment对象组成,每个这样的对象均描绘图形的一条线段.<br>PathGeometry所支持的Segment<br>ArcSegment 在两个点之间创建一条椭圆弧线<br>BezierSegment 在两个点之间创建一条三次方贝塞尔曲线<br>LineSegment 在两个点之间创建一条直线<br>PolyBezierSegment 创建一系列三次方贝塞尔曲线.<br>PolyQuadraticBezierSegment 创建一系列二次方贝塞尔曲线<br>PolyLineSegment 创建一系列直线<br>QuadraticBezierSegment 创建一条二次贝塞尔曲线<br>PathGeometry的Figures属性可以容纳PathFigure对象.而PathFigure对象的Segments属性又可以容纳各种线段用来组合成复杂的图形.<br>1.LineSegment和PolylineSegment<br>LineSegment类表示在两个点之间绘制一条线,它可能是Path数据的PathFigure的一部分.使用PathFigure对象通过LineSegment对象和其他线段来创建复合形状.LineSegment类不包含用于直线起点的属性,直线的起点是前一条线段的终点,如果不存在其他线段,则为PathFigure的StartPoint;其他的Segment也是一样的规则.<br>可以使用Line生成线条的简单形状,LineSegment用于在更复杂的几何组中绘制线.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;Path Stroke=<span class="string">&quot;Red&quot;</span> StrokeThickness=<span class="string">&quot;5&quot;</span>&gt;</span><br><span class="line">                    &lt;Path.Data&gt;</span><br><span class="line">                        &lt;PathGeometry&gt;</span><br><span class="line">                            &lt;PathFigure StartPoint=<span class="string">&quot;10,20&quot;</span>&gt;</span><br><span class="line">                                &lt;PathFigure.Segments&gt;</span><br><span class="line">                                    &lt;LineSegment Point=<span class="string">&quot;100,130&quot;</span>/&gt;</span><br><span class="line">                                &lt;/PathFigure.Segments&gt;</span><br><span class="line">                            &lt;/PathFigure&gt;</span><br><span class="line">                        &lt;/PathGeometry&gt;</span><br><span class="line">                    &lt;/Path.Data&gt;</span><br><span class="line">                &lt;/Path&gt;</span><br></pre></td></tr></table></figure>
<p>PolyLineSegment类表示由PointCollection定义的线段集合,每个Point指定线段的终点.<br>PolyLineSegment在Xaml上语法示例如下,省略掉部分Path的代码与上文相同</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;PolyLineSegment Points=<span class="string">&quot;50,100,50,150&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>2.ArcSegment绘制圆弧.<br>Point属性指明圆弧连接的终点,Size属性表示完整椭圆的横轴和纵轴半径.RotationAngle属性指明圆弧母椭圆的旋转角度,SweepDirection属性指明圆弧是顺时针方向还是逆时针方向,IsLargeArc属性指明是否使用大弧去连接,如果椭圆上的两个点的位置不对称,这两点间的圆弧就会分为大弧和小弧.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;Path Stroke=<span class="string">&quot;Red&quot;</span> StrokeThickness=<span class="string">&quot;5&quot;</span>&gt;</span><br><span class="line">                    &lt;Path.Data&gt;</span><br><span class="line">                        &lt;PathGeometry&gt;</span><br><span class="line">                            &lt;PathGeometry.Figures&gt;</span><br><span class="line">                                &lt;PathFigure StartPoint=<span class="string">&quot;10,50&quot;</span>&gt;</span><br><span class="line">                                    &lt;PathFigure.Segments&gt;</span><br><span class="line">                                        &lt;ArcSegment Size=<span class="string">&quot;50,50&quot;</span> RotationAngle=<span class="string">&quot;45&quot;</span> IsLargeArc=<span class="string">&quot;True&quot;</span> SweepDirection=<span class="string">&quot;Clockwise&quot;</span> Point=<span class="string">&quot;200,100&quot;</span>&gt;</span><br><span class="line">                                            </span><br><span class="line">                                        &lt;/ArcSegment&gt;</span><br><span class="line">                                    &lt;/PathFigure.Segments&gt;</span><br><span class="line">                                &lt;/PathFigure&gt;</span><br><span class="line">                            &lt;/PathGeometry.Figures&gt;</span><br><span class="line">                        &lt;/PathGeometry&gt;</span><br><span class="line">                    &lt;/Path.Data&gt;</span><br><span class="line">                &lt;/Path&gt;</span><br></pre></td></tr></table></figure>
<p>3.BezierSegment,PolyBezierSegment,PolyQuadraticBezierSegment和QuadraticBezierSegment<br>一条三次方贝塞尔曲线由4个点定义:一个起点,一个终点,和两个控制点(Point1和Point2).三次方贝塞尔曲线的两个控制点作用像磁铁一样,朝着自身的方向吸引本应为直线的部分,从而形成一条曲线.第一个控制点Point1影响曲线的开始部分;第二个控制点Point2影响曲线的结束部分.注意,曲线不一定必须通过两个控制点之一.每个控制点将直线的一部分朝着自己的方向移动,但不能通过自身,PolyBezierSegment通过将Points属性设置为点集合来指定一条或多条三次方贝塞尔曲线.PolyBezierSegment实质上可以有无限个控制点,这些点和终点的值由Points属性值提供.<br>QuadraticBezierSegment表示二次方贝塞尔曲线,与BezierSegment类似,只是控制点由两个变成了一个.也就是说QuadraticBezierSegment由3个点决定:起点(即前一个线段的终点或PathFigure的StartPoint),终点(Point2属性,即曲线的终止位置)和控制点(Point1属性)<br>7.24.使用路径标记语法创建Path<br>路径标记语法 就是各种线段的简记法.<LineSegment point="150,5"/>可以简写为”L 150,5”<br>还增加了一些更实用的绘图命令 H用来绘制水平线,”H 180”就是指从当前点画一条水平直线,终点的横坐标是180.(不需要考虑纵坐标,纵坐标和当前点一致.) 类似的还有V命令,用来划竖直直线.<br>使用路径标记语法绘图一般分三步,移动至起点—绘图—闭合图形 移动M 绘图 L ,H,V,A,C,Q等.如果图形是闭合的,需要使用闭合命令Z,这样最后一条线段终点与第一条线段的起点就会连接上一条直线段.<br>在路径标记语法中使用两个Double类型的数值来表示一个点.第一个值表示的是横坐标(记作X),第二个值表示纵坐标(记作y),两个数字可以使用逗号分隔(x,y),也可以使用空格分隔. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Path Stroke=<span class="string">&quot;Red&quot;</span> StrokeThickness=<span class="string">&quot;3&quot;</span> Data=<span class="string">&quot;M 100,200 C 100,25 400,350 400,175 H 280&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>上面Path创建了由一条贝塞尔曲线线段和一条线段组成的Path.Data字符串以’move’命令开头(M),建立起点,大写的M表示新的当前点的绝对位置.小写的m表示相对位置.第一个线段是一个三次方贝塞尔曲线,该曲线从(100,200)开始,在(400,175)结束,使用(100,25)和(400,350)这两个控制点绘制.此线段由Data字符串中的C命令指示.同样,大写的C表示绝对路径,小写的c代表相对路径.第二个线段以绝对水平线命令H开头,它指定绘制一条从前面的子路径的终结点(400,175)到新终结点(280,175)的直线.由于他是一个水平线命令,因此指定的值是x坐标.<br>路径标记语法<br>移动指令 M  M x,y或m x,y 大写M x,y是绝对值;小写的m指示x,y是相对于上一个点的偏移量, 0,0表示不存在偏移.在move命令之后列出多个点时,即使指定的是线条命令,也将绘制出连接这些点的线.<br>绘制指令 通过使用一个大写或小写字母输入各命令,大写表示绝对值,小写表示相对值,线段的控制点是相对于上一线段终点而言的,依次输入多个同一类型的命令时,可以省略重复的命令项,例如,L 100,200 300,400 等同于L 100,200 L 300,400<br>    直线 Line L 格式:L结束点坐标 或I结束点坐标. L 100<br>    水平直线 Horizontal line H H x值或h x值(x为System.Double类型的值) 绘制从当前点到指定x坐标的水平直线. H 100<br>    垂直直线 Vertical line V V y或v y值 绘制从当前点到指定y坐标的垂直直线. V1 100<br>    三次方贝塞尔曲线 Cubic Bezier curve C C第一控制点 第二控制点 结束点 通过指定两个控制点来绘制由当前点到指定结束点间的三次方程贝塞尔曲线. C 100,200 200,400 300,200   100,200为第一控制点<br>    二次方程式贝塞尔曲线 Quadratic Bezier curve Q Q控制点结束点或q控制点结束点 通过指定的一个控制点来绘制由当前点到指定结束点间的二次方程贝塞尔曲线. q 100,200 300,200  100,200控制点 300，200 结束点<br>    平滑三次方程式贝塞尔曲线 Smooth cubic Bezier curve (S) S控制点结束点或s控制点结束点 通过一个指定点来”平滑”控制当前点到指定点的贝塞尔曲线 如 S 100,200 200,300<br>    平滑二次方程式贝塞尔曲线 smooth quadratic bezier curver T  T控制点 结束点  T 100,200 200,300<br>    椭圆圆弧:elliptical Arc A A尺寸圆弧旋转角度值优势弧的标记正负角度标记结点 在当前点与指定结束点间绘制圆弧.<br>    尺寸 Size 指定椭圆圆弧X,Y方向上的半径值.<br>    旋转角度 rotationAngle System.Double类型. 圆弧旋转角度值<br>    优势弧的标记(isLargeArcFlag) 是否为优势弧,如果弧的角度大于等于180°,则设为1,否则为0<br>    正负角度标记(sweepDirectionFlag) 当正角方向绘制时设为1 否则为0.<br>    结束点 endPoint  例如:A 5,5 0 0 1 10,10<br>关闭指令 可选 用Z或z表示.用以将图形的首,尾点用直线连接,以形成一个封闭的区域<br>填充规则 fileRule 如果省略此命令,则路径使用默认行为,即EvenOdd.如果指定此命令,则必须将其置于最前面.<br>    EvenOdd填充规则 F0指定EvenOdd填充规则.EvenOdd确定一个点是否位于填充区域内的规则方法:从该点沿任意方向画一条无限长的射线,然后计算该射线在给定形状中因交叉而形成的路径段数.如果该数为奇数，则点在内部;如果为偶数,则点在外部<br>    Nonzero填充规则 F1指定Nonzero填充规则 Nonzero确定一个点是否位于路径填充区域内的的规则方法:从该点沿任意方向画一条无限长的射线,然后检查形状段与该射线的交点,从0开始计数,每当线段从左到右穿过该射线时加1,而每当路径段从左到右穿过该射线时加1,而每当路径段从右向左穿过该射线-1.计算交点的数目后,如果结果为0,则说明该点位于路径外部,否则,它位于路径内部.<br>7.25.使用Path实现自定义图形<br>布局面板通过重载FrameworkElement类的ArrangeOverride方法对子对象进行排列,从Path类派生的图形类一样也可以通过重载ArrangeOverride方法对图形进行初始化.在初始化逻辑生成适用于自定义形状的几何图形,随后再将其设置赋值给Path.Data属性,可以充分利用Width和Height等这些Path自带的属性作为自定义图形的相关参数,当然如果需要额外的参数,也是可以通过实现自定义属性进行传递.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">  &lt;Grid x:Name=<span class="string">&quot;HexagonContentPanel&quot;</span> Margin=<span class="string">&quot;12,0,12,0&quot;</span>&gt;</span><br><span class="line">                   &lt;controls:Hexagon Height=<span class="string">&quot;300&quot;</span> Width=<span class="string">&quot;300&quot;</span> Stroke=<span class="string">&quot;Yellow&quot;</span> StrokeThickness=<span class="string">&quot;8&quot;</span> Fill=<span class="string">&quot;Red&quot;</span>/&gt;</span><br><span class="line">               &lt;/Grid&gt;</span><br><span class="line"></span><br><span class="line">public class Hexagon : Path</span><br><span class="line">   &#123;</span><br><span class="line">       private double lastWidth = 0;</span><br><span class="line">       private double lastHeight = 0;</span><br><span class="line">       private PathFigure figure;</span><br><span class="line">       public <span class="function"><span class="title">Hexagon</span></span>()</span><br><span class="line">       &#123;</span><br><span class="line">           CreateDataPath(0,0);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private void CreateDataPath(double width,double height)</span><br><span class="line">       &#123;</span><br><span class="line">           //把高度和宽度先减去边的宽度</span><br><span class="line">           height -= this.StrokeThickness;</span><br><span class="line">           width-= this.StrokeThickness;</span><br><span class="line">           //用来跳出布局的循环,因为只创建一次</span><br><span class="line">           <span class="keyword">if</span> (lastWidth == width &amp;&amp; lastHeight == height)</span><br><span class="line">               <span class="built_in">return</span>;</span><br><span class="line">           lastWidth= width;</span><br><span class="line">           lastHeight= height;</span><br><span class="line">           PathGeometry geometry= new PathGeometry();</span><br><span class="line">           figure= new PathFigure();</span><br><span class="line">           //取左上角的点为第一个点</span><br><span class="line">           figure.StartPoint=new Windows.Foundation.Point(0.25*width,0);</span><br><span class="line">           //算出每个顶点的坐标然后创建线段连接起来</span><br><span class="line">           AddPoint(0.75*width,0);</span><br><span class="line">           AddPoint(width,0.5*height);</span><br><span class="line">           AddPoint(0.75*width,height);</span><br><span class="line">           AddPoint(0.25*width,height);</span><br><span class="line">           AddPoint(0,0.5*height);</span><br><span class="line">           figure.IsClosed= <span class="literal">true</span>;</span><br><span class="line">           geometry.Figures.Add(figure);</span><br><span class="line">           this.Data = geometry;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       private void AddPoint(double x, double y)</span><br><span class="line">       &#123;</span><br><span class="line">          LineSegment segment= new LineSegment();</span><br><span class="line">           segment.Point=new Point(x+0.5*StrokeThickness,y+0.5*StrokeThickness);</span><br><span class="line">           figure.Segments.Add(segment);</span><br><span class="line">       &#125;</span><br><span class="line">       protected override Size MeasureOverride(Size availableSize)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="built_in">return</span> availableSize;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       protected override Size ArrangeOverride(Size finalSize)</span><br><span class="line">       &#123;</span><br><span class="line">           //初始化图形</span><br><span class="line">           CreateDataPath(finalSize.Width,finalSize.Height);</span><br><span class="line">           <span class="built_in">return</span> finalSize;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>7.26.利用Expression Blend工具创建Path图形<br>1.使用笔或者铅笔工具画出Path图形<br>打开Expression Blend工具,可以找到左边图标工具栏上的笔或铅笔<br>2.把相关的图形转换成Path图形.<br>在Blend里面除了基本图形外,还封装了很多其他的图形,可以直接把这些图形转换为Path图形.转换的方法是在图形上面,右键——&gt;路径——&gt;转换为路径,这时候就把相关的图形转换为Path绘图的方式.<br>3.通过合并图形的方式生成Path图形<br>合并图形的方式是指在Blend里面创建了多个图形,按住Ctrl键把要合并的图形选中,然后右键—&gt;合并—&gt;相并/拆分/相交/相减/排除重叠.<br>4.导入设计的源文件<br>在Blend里可以导入Illustrator文件/FXG文件/Photoshop文件,把这些文件转换为XAML编码,同时也会把里面相关的图形转换为Path图形,这是Blend工具提供的一个非常有用的一个功能,通常设计师会采用Phoneshop设计图片,直接把设计好的Photoshop文件导入就可以把文件转成为XAML编码<br>7.3画刷<br>使用XAML时,在控件的Background,Foreground和Fill属性中简单的输入颜色名,应用程序运行时就会将字符串值转换为有效的颜色资源对应的画刷.<br>7.31.SolidColorBrush画刷<br>SolidColorBrush画刷主要用来填充单色形状或控件,可以直接通过颜色进行创建,在Xaml中直接输入颜色名使用的就是SolidColorBrush画刷,可以通过直接使用Colors里面的颜色值进行赋值.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Rectangle width=<span class="string">&quot;100&quot;</span> height=<span class="string">&quot;100&quot;</span> Fill=<span class="string">&quot;#FFFF0000&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>
<p>7.32.LinearGradientBrush画刷<br>线性渐变画刷(LinearGradientBrush)用来填充一个复合渐变色到一个元素中,并且可以任意搭配两种或两种以上的颜色,重要的属性有倾斜点(GradientStop),渐变颜色(Color),起始坐标点(StartPoint),结束坐标点(EndPoint).</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;Path Canvas.Left=<span class="string">&quot;15&quot;</span> Canvas.Top=<span class="string">&quot;50&quot;</span> Stroke=<span class="string">&quot;Black&quot;</span> Data=<span class="string">&quot;M 0,0 A 15,5 180 1 1 200,0 L 200,100 L 300,100 L 300,200 A 15,5 180 1 1 100,200 L 100,100 L 0,100 Z&quot;</span>&gt;</span><br><span class="line">	&lt;Path.Fill&gt;</span><br><span class="line">		&lt;LinearGradientBrush StartPoint=<span class="string">&quot;0,0&quot;</span> EndPoint=<span class="string">&quot;1,0&quot;</span>&gt;</span><br><span class="line">			&lt;GradientStop Offset=<span class="string">&quot;0&quot;</span> Color=<span class="string">&quot;DarkBlue&quot;</span>/&gt;</span><br><span class="line">			&lt;GradientStop Offset=<span class="string">&quot;1&quot;</span> Color=<span class="string">&quot;LightBlue&quot;</span>/&gt;</span><br><span class="line">		&lt;/LinearGradientBrush&gt;</span><br><span class="line">	&lt;/Path.Fill&gt;</span><br><span class="line">&lt;/Path&gt;</span><br></pre></td></tr></table></figure>
<p>7.33.ImageBrush画刷<br>ImageBrush画刷使用图像绘制一个区域,由其ImageSource属性指定的JPEG或PNG图像绘制区域,默认情况下,ImageBrush会将其图像拉伸以完全充满要绘制的区域,如果绘制的区域和该图像的长宽比不同,则可能会扭曲该图像.可以通过将Stretch属性从默认值Fill更改为None,Uniform或者UniformToFill来更改此现象.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Ellipse Height=<span class="string">&quot;180&quot;</span> Width=<span class="string">&quot;180&quot;</span> Margin=<span class="string">&quot;50,0,0,0&quot;</span>&gt;</span><br><span class="line">	&lt;Ellipse.Fill&gt;</span><br><span class="line">		&lt;ImageBrush ImageSource=<span class="string">&quot;Assets/ApplicationIcon.png&quot;</span> Stretch=<span class="string">&quot;Fill&quot;</span>/&gt;</span><br><span class="line">	&lt;/Ellipse.Fill&gt;</span><br><span class="line">&lt;/Ellipse&gt;</span><br></pre></td></tr></table></figure>
<p>通常会利用ImageBrush来做一些特别的遮罩效果,<br>7.4 图形裁剪<br>Geometry类型还有一个用途就是可以用在UIElement的Clip属性上对从UIElement派生的控件进行图形裁剪,裁剪出来的形状就是Geometry类型所构成的图形.Geometry类型在UIElement的Clip属性上的语法和在Path的Data属性上的语法完全一样.<br>7.41.使用几何图形进行裁剪<br>裁剪图像时是指仅把图像的某个局部区域的图像显示出来.可以通过使用UIElement的Clip属性来设置图像裁剪的区域,Clip属性值为Geometry类型的派生类,可以取值为RectangleGeometry类型,这就意味着可以从图像中裁切掉矩形的几何形状.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Image Source=<span class="string">&quot;myImage.jpg&quot;</span> Width=<span class="string">&quot;200&quot;</span> Height=<span class="string">&quot;150&quot;</span>&gt;</span><br><span class="line">	&lt;Image.Clip&gt;</span><br><span class="line">		&lt;RectangleGeometry Rect=<span class="string">&quot;0,0,50,50&quot;</span>/&gt;</span><br><span class="line">	&lt;/Image.Clip&gt;</span><br><span class="line">&lt;/Image&gt;</span><br></pre></td></tr></table></figure>
<p>因为Clip属性是UIElement的属性,所以不仅仅只有Image控件可以使用其来裁剪图形,所有的UI对象都可以使用Clip属性对UI进行裁剪.<br>7.42.对布局区域进行剪裁<br>使用布局面板来布局一些子控件,实际上这些子控件所在的位置可以超出布局面板的范围,实现一个布局面板,让面板里的子控件都在面板的范围里,超出面板就不可见.可以利用Clip属性去实现,因为Clip属性是UIElement类的属性,也就是说所有的XAML控件都可以使用这个属性去进行图形裁剪.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">  &lt;Grid x:Name=<span class="string">&quot;ClipContentPanel&quot;</span> Margin=<span class="string">&quot;12,0,12,0&quot;</span>&gt;</span><br><span class="line">                    &lt;Canvas Background=<span class="string">&quot;White&quot;</span> Margin=<span class="string">&quot;20&quot;</span> controls:Clip.ToBounds=<span class="string">&quot;True&quot;</span>&gt;</span><br><span class="line">                        &lt;Ellipse Fill=<span class="string">&quot;Red&quot;</span> Canvas.Top=<span class="string">&quot;-10&quot;</span> Canvas.Left=<span class="string">&quot;-10&quot;</span> Width=<span class="string">&quot;200&quot;</span> Height=<span class="string">&quot;200&quot;</span>/&gt;</span><br><span class="line">                    &lt;/Canvas&gt;</span><br><span class="line">                &lt;/Grid&gt;</span><br><span class="line"></span><br><span class="line">public class Clip </span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public static bool GetToBounds(DependencyObject obj)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">return</span> (bool)obj.GetValue(ToBoundsProperty);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static void SetToBounds(DependencyObject obj, bool value)</span><br><span class="line">        &#123;</span><br><span class="line">            obj.SetValue(ToBoundsProperty, value);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // Using a DependencyProperty as the backing store <span class="keyword">for</span> ToBounds.  This enables animation, styling, binding, etc...</span><br><span class="line">        public static <span class="built_in">readonly</span> DependencyProperty ToBoundsProperty =</span><br><span class="line">            DependencyProperty.RegisterAttached(<span class="string">&quot;ToBounds&quot;</span>, typeof(bool), typeof(Clip), new PropertyMetadata(<span class="literal">false</span>,OnToBoundsPropertyChanged));</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 定义属性改变事件</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;d&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;exception cref=<span class="string">&quot;NotImplementedException&quot;</span>&gt;&lt;/exception&gt;</span><br><span class="line">        private static void OnToBoundsPropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            FrameworkElement fe = d as FrameworkElement;</span><br><span class="line">            <span class="keyword">if</span> (fe != null)</span><br><span class="line">            &#123;</span><br><span class="line">                //裁剪图形</span><br><span class="line">                ClipToBounds(fe);</span><br><span class="line">                //当对象加载或者大小改变时都需要重新处理边界</span><br><span class="line">                fe.Loaded += Fe_Loaded;</span><br><span class="line">                fe.SizeChanged += Fe_SizeChanged;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static void Fe_SizeChanged(object sender, SizeChangedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            ClipToBounds(sender as FrameworkElement);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static void Fe_Loaded(object sender, RoutedEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            ClipToBounds(sender as FrameworkElement);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static void ClipToBounds(FrameworkElement fe)</span><br><span class="line">        &#123;</span><br><span class="line">            //如果ToBounds设置为<span class="literal">true</span>则进行裁剪</span><br><span class="line">            <span class="keyword">if</span> (GetToBounds(fe))</span><br><span class="line">            &#123;</span><br><span class="line">                //使用布局面板的实际高度和宽度来创建一个RectangleGeometry赋值给Clip属性</span><br><span class="line">                fe.Clip = new Windows.UI.Xaml.Media.<span class="function"><span class="title">RectangleGeometry</span></span>()</span><br><span class="line">                &#123;</span><br><span class="line">                    Rect = new Windows.Foundation.Rect(0, 0, fe.ActualWidth, fe.ActualHeight)</span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                fe.Clip = null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>7.5.使用位图编程<br>Image控件用于显示图片,在Win10中将一张图片显示出来可以添加一个Image控件,然后在控件中设置图片的路径.使用Image控件显示图片语法如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Image Source=<span class="string">&quot;myPicture.png&quot;</span>/&gt;</span><br><span class="line">Image myImage=new Image();</span><br><span class="line">myImage.Source=new BitmapImage(new Uri(<span class="string">&quot;ms-appx:///myPicture.jpg&quot;</span>,UriKind.Absolute));</span><br></pre></td></tr></table></figure>
<p>Source属性用于指定要显示的图像位置,在路径中,使用ms-appx URI方案名称编写安装文件夹地址:ms-appx:///，表示指向于安装包文件的地址.<br>7.51 拉伸图像<br>如果没有设置Image的Width和Height值,使用图像自然尺寸显示,Stretch:None,Uniform,Uniform    ToFill.<br>7.52.使用RenderTargetBitmap类生成图片<br>RenderTargetBitmap类可以将可视化对象转换为位图,也就是说可以将任意的UIElement以位图的形式呈现,在实现的编程中通常利用RenderTartgetBitmap类对UI界面进行截图操作.<br>使用RenderTargetBitmap类生成图片一般有两种用途,一种是直接把生成的图片在当前的页面上进行展示,还有一种是把生成的图片当作文件存储起来,或者通过某种分享方向把图片文件分享出去.<br>使用RenderTargetBitmap类生成图片操作主要是依赖于RenderTargetBitmap类的RenderAsync方法.<br>RenderAsync方法有两个重载;RenderAsync(UIElement)和RenderAsync(UIElement,Int32,Int32),可在后者处指定要与源可视化树的自然大小不同的所需图像源尺寸.RenderAsync方法设计为异步方法,因此无法保证与UI源进行精确的框架同步,但大多数情况下都足够及时.由于RenderTargetBitmap是ImageSource的子类,因此,可以将其用作Image元素或ImageBrush画笔的图像源.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;PivotItem Header=<span class="string">&quot;RenderTargetBitmap&quot;</span>&gt;</span><br><span class="line">               &lt;!--注册PointerReleased事件用于捕获屏幕的单击操作,并在时间处理程序中生成图片.--&gt;</span><br><span class="line">               &lt;Grid x:Name=<span class="string">&quot;root&quot;</span> Background=<span class="string">&quot;&#123;ThemeResource ApplicationPageBackgroundThemeBrush&#125;&quot;</span> PointerReleased=<span class="string">&quot;root_PointerReleased&quot;</span>&gt;</span><br><span class="line">                   &lt;Grid.RowDefinitions&gt;</span><br><span class="line">                       &lt;RowDefinition Height=<span class="string">&quot;Auto&quot;</span>/&gt;</span><br><span class="line">                       &lt;RowDefinition Height=<span class="string">&quot;*&quot;</span>/&gt;</span><br><span class="line">                   &lt;/Grid.RowDefinitions&gt;</span><br><span class="line">                   &lt;StackPanel x:Name=<span class="string">&quot;TitlePanel&quot;</span> Margin=<span class="string">&quot;12,35,0,28&quot;</span>&gt;</span><br><span class="line">                       &lt;TextBlock Text=<span class="string">&quot;我的应用程序&quot;</span> FontSize=<span class="string">&quot;20&quot;</span>/&gt;</span><br><span class="line">                       &lt;TextBlock Text=<span class="string">&quot;点击截屏&quot;</span> FontSize=<span class="string">&quot;60&quot;</span>/&gt;</span><br><span class="line">                   &lt;/StackPanel&gt;</span><br><span class="line">                   &lt;Grid x:Name=<span class="string">&quot;RenderTargetBitmapContentPanel&quot;</span> Grid.Row=<span class="string">&quot;1&quot;</span> Margin=<span class="string">&quot;12,0,12,0&quot;</span>&gt;</span><br><span class="line">                   &lt;!--该图片控件用于展示截图图片效果--&gt;</span><br><span class="line">                       &lt;Image x:Name=<span class="string">&quot;img&quot;</span>/&gt;</span><br><span class="line">                   &lt;/Grid&gt;</span><br><span class="line">               &lt;/Grid&gt;</span><br><span class="line">           &lt;/PivotItem&gt;</span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">       /// 指针释放的事件处理程序</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private async void root_PointerReleased(object sender, PointerRoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           //创建一个RenderTargetBitmap对象,对界面中的Grid控件root生成图片</span><br><span class="line">           RenderTargetBitmap bitmap = new RenderTargetBitmap();</span><br><span class="line">           await bitmap.RenderAsync(root);</span><br><span class="line">           //把图片展现出来</span><br><span class="line">           img.Source=bitmap;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>7.53.存储生成的图片文件<br>在调用RenderAsync方法时会初始化RenderTargetBitmap类的对象,但是RenderTargetBitmap类的对象本身并不能作为图片来进行存储,要生成图片文件需要获取到图片的二进制数据,如果想要获取DataTransferManager操作 如共享协定交换的图像,或者想要使用Windows.Graphics.Imaging Api将效果应用到图像上或对图像进行转码,就需要用到像素数据,如果访问RenderTargetBitmap的pIxels数据,需要在用RenderAsync方法将UIElement定义为RenderTargetBitmap后m在调用RenderTargetBitmpa的GetPixelsAsync方法来获取其Pixels数据,该方法返回值是IBuffer类型,里面存储的是二进制位图数,这个IBuffer可以转换成一个Byte数组,数组里面的数据以BGRA8格式存储.<br>以下代码示例如何从一个RenderTargetBitmap对象中获得以Byte数组类型存储的像素数.需要特别注意的是IBuffer实例调用的ToArray方法是一个扩展方法,需要在项目中加入System.Runtime.InteropServices.WindowsRuntime这个命名空间.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var bitmap=new RenderTargetBitmap();</span><br><span class="line">await bitmap.RenderAsync(elementToRender);</span><br><span class="line">IBuffer pixelBuffer=await bitmap.GetPixelsAsync();</span><br><span class="line">byte[] pixels=pixelBuffer.ToArray();</span><br></pre></td></tr></table></figure>
<p>在获取到了图像的二进制数据之后,如果要把二进制的数据生成图片文件,需要使用到BitmapEncoder类.BitmapEncoder类包含创建,编辑和保存图像的各种方法.创建图片文件首先需要调用BitmapEncoder类CreateAsync方法,使用文件的流创建一个BitmapEncoder对象,然后再使用BitmapEncoder类的SetPixelData设置图像有关帧的像素数据.SetPixelData的方法参数如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SetPixelData(BitmapPixelFormat pixelFormat,BitmapAlphaMode alphaMode,uint width,uint height,double dpiX,double dpiY,byte[] pixels)</span><br></pre></td></tr></table></figure>
<p>其中,pixelFormat表示像素数据的像素格式,alphaMode表示像素数据的alpha模式,width表示像素数据的宽度(以像素为单位),height表示像素数据的高度(以像素为单位);dpiX表示像素数据的水平分辨率(以每英寸点数为单位);pixels表示像素数据.该方法是同步的,因为直到调用FlushAsync,GoToNextFrameAsync或GoToNextFrameAsync(IIterable(IkeyValuePair))才会提交数据.该方法将所有像素数据视为sRGB颜色空间中的像素数据.<br>保存截图文件的示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">           &lt;PivotItem Header=<span class="string">&quot;SaveBitmapEncoder&quot;</span>&gt;</span><br><span class="line">               &lt;Grid x:Name=<span class="string">&quot;root1&quot;</span> Background=<span class="string">&quot;&#123;ThemeResource ApplicationPageBackgroundThemeBrush&#125;&quot;</span>&gt;</span><br><span class="line">                   &lt;Grid x:Name=<span class="string">&quot;BitmapEncoderContentPanel&quot;</span> Margin=<span class="string">&quot;12,0,12,0&quot;</span>&gt;</span><br><span class="line">                       &lt;StackPanel&gt;</span><br><span class="line">                           &lt;Button x:Name=<span class="string">&quot;bt_save1&quot;</span> Content=<span class="string">&quot;存储生成的图片&quot;</span> Click=<span class="string">&quot;bt_save_Click_2&quot;</span>/&gt;</span><br><span class="line">                           &lt;Button x:Name=<span class="string">&quot;bt_show&quot;</span></span><br><span class="line">                                   Content=<span class="string">&quot;展示存储的图片&quot;</span></span><br><span class="line">                                   Click=<span class="string">&quot;bt_show_Click&quot;</span>/&gt;</span><br><span class="line">                           &lt;ScrollViewer BorderBrush=<span class="string">&quot;Red&quot;</span> BorderThickness=<span class="string">&quot;2&quot;</span> Height=<span class="string">&quot;350&quot;</span>&gt;</span><br><span class="line">                               &lt;Image x:Name=<span class="string">&quot;img1&quot;</span>/&gt;</span><br><span class="line">                               </span><br><span class="line">                           &lt;/ScrollViewer&gt;</span><br><span class="line">                       &lt;/StackPanel&gt;</span><br><span class="line">                   &lt;/Grid&gt;</span><br><span class="line">               &lt;/Grid&gt;</span><br><span class="line">           &lt;/PivotItem&gt;</span><br><span class="line">/// &lt;summary&gt;</span><br><span class="line">       /// 按钮事件生成图片并保存到程序的存储里</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private async void bt_save_Click_2(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           //生成RenderTargetBitmap对象.</span><br><span class="line">           RenderTargetBitmap bitmapbitmap = new RenderTargetBitmap();</span><br><span class="line">           await bitmapbitmap.RenderAsync(root1);</span><br><span class="line">           //获取图像的二进制数据</span><br><span class="line">           var pixelBuffer=await bitmapbitmap.GetPixelsAsync();</span><br><span class="line">           //创建程序文件存储</span><br><span class="line">           IStorageFolder applicationFolder=ApplicationData.Current.LocalFolder;</span><br><span class="line">           IStorageFile saveFile = await applicationFolder.CreateFileAsync(<span class="string">&quot;snapshot.png&quot;</span>,CreationCollisionOption.OpenIfExists);</span><br><span class="line">           //把图片的二进制数据写入文件存储</span><br><span class="line">           using (var fileStream=await saveFile.OpenAsync(FileAccessMode.ReadWrite))</span><br><span class="line">           &#123;</span><br><span class="line">               var encoder = await BitmapEncoder.CreateAsync(BitmapEncoder.PngEncoderId,fileStream);</span><br><span class="line">               encoder.SetPixelData(</span><br><span class="line">                   BitmapPixelFormat.Bgra8,</span><br><span class="line">                   BitmapAlphaMode.Ignore,</span><br><span class="line">                   (uint)bitmapbitmap.PixelWidth,</span><br><span class="line">                   (uint)bitmapbitmap.PixelHeight,</span><br><span class="line">                   DisplayInformation.GetForCurrentView().LogicalDpi,</span><br><span class="line">                   DisplayInformation.GetForCurrentView().LogicalDpi,</span><br><span class="line">                   pixelBuffer.ToArray());</span><br><span class="line">               await encoder.FlushAsync();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// 展示程序存储图片的按钮事件</span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;sender&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=<span class="string">&quot;e&quot;</span>&gt;&lt;/param&gt;</span><br><span class="line">       private void bt_show_Click(object sender, RoutedEventArgs e)</span><br><span class="line">       &#123;</span><br><span class="line">           // “ms-appdata:///local”表示是程序存储的根目录</span><br><span class="line">           BitmapImage bitmapImage=new BitmapImage(new Uri(<span class="string">&quot;ms-appdata:///local/snapshot.png&quot;</span>,UriKind.Absolute));</span><br><span class="line">           img1.Source= bitmapImage;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

        </div>
        
            <div class="kratos-copyright text-center clearfix">
                <h5>本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
            </div>
        
        <footer class="kratos-entry-footer clearfix">
            
                <div class="post-like-donate text-center clearfix" id="post-like-donate">
                
                
                    <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                    <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "https://drfengyu.github.io/qm/5bdeb856.html",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "https://drfengyu.github.io/qm/5bdeb856.html";
            const title         = "「深入浅出Windows应用程序开发(二)」";
            const excerpt       = `应用数据6.1 应用设置简介1.拥有容器的层次结构2.有本地和漫游两种设置类型Win10支持本地和漫游两种类型,本地是指数据只会存在于当前的客户端应用程序里面,漫游则是指数据会同步到其他设备的相同账户的客户端里.本地应用设置是在根容器...`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    <a class="tag-none-link" href="/tags/UWP/" rel="tag">UWP</a>
                </div>
                <div class="pull-date">
                <span>最后编辑：2023-11-07</span>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" 深入浅出Windows通用应用程序开发(一)" href="/qm/7b676f35.html">&lt; 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" Windows通用应用程序开发(三)" href="/qm/50fedeca.html">下一篇 &gt;</a>
            </div>
            
        </nav>
    
    
        <link rel="stylesheet" href="https://unpkg.com/gitalk@1/dist/gitalk.css">
<div id="gitalk-container" class="post-comments lazy-load" style="padding-left:2rem; padding-right:2rem;"></div>
<script>
    var load_comm = () => {
        const init = () => {
            console.log('Gitalk loading...');
            const gitalk = new Gitalk(Object.assign({
                id: '/qm/5bdeb856.html',
                path: '/qm/5bdeb856.html'
            }, JSON.parse('{"clientID":"67075d9ed7922a3c9791","clientSecret":"50ce067bd2bb3d9e9e48d56804da1a6d25e7bf16","repo":"dryunment","owner":"Drfengling","admin":["Drfengling"],"distractionFreeMode":false}')));

            gitalk.render('gitalk-container');
        }
        if (typeof Gitalk === 'undefined') {
            const src = 'https://unpkg.com/gitalk@1/dist/gitalk.min.js';
            $.getScript(src, init);
        } else {
            init();
        }
    };
load_comm();
</script>
<noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="https://github.com/gitalk/gitalk">comments powered by Gitalk.</a></noscript>
    
</article>

        

            </section>

        
                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/avatar.webp" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                28
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                8
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                15
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix">
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar"></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E6%95%B0%E6%8D%AE"><span class="toc-text">应用数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%BE%E5%BD%A2%E7%BB%98%E5%9B%BE"><span class="toc-text">图形绘图</span></a></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Asp-Net/">Asp.Net</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C#</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/WPF/">WPF</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web%E6%9C%8D%E5%8A%A1/">Web服务</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Windows应用开发</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Windows%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/">Windows应用程序开发</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%9A%E5%AE%A2%E6%97%A5%E8%AE%B0/">博客日记</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BA%BF%E4%B8%8A%E8%AF%84%E8%AE%BA/">线上评论</a><span class="category-list-count">2</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/Aplayer/" style="font-size: 0.6em;">Aplayer</a> <a href="/tags/C/" style="font-size: 0.6em;">C#</a> <a href="/tags/GitHub/" style="font-size: 0.7em;">GitHub</a> <a href="/tags/Gitalk/" style="font-size: 0.6em;">Gitalk</a> <a href="/tags/Hexo/" style="font-size: 0.7em;">Hexo</a> <a href="/tags/Nginx/" style="font-size: 0.6em;">Nginx</a> <a href="/tags/Nodejs/" style="font-size: 0.7em;">Nodejs</a> <a href="/tags/UWP/" style="font-size: 0.75em;">UWP</a> <a href="/tags/WCF/" style="font-size: 0.7em;">WCF</a> <a href="/tags/WPF/" style="font-size: 0.8em;">WPF</a> <a href="/tags/livere/" style="font-size: 0.6em;">livere</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96/" style="font-size: 0.6em;">博客美化</a> <a href="/tags/%E6%97%A5%E8%AE%B0/" style="font-size: 0.6em;">日记</a> <a href="/tags/%E8%A7%86%E9%A2%91/" style="font-size: 0.6em;">视频</a> <a href="/tags/%E9%9F%B3%E4%B9%90/" style="font-size: 0.65em;">音乐</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/qm/4a17b156.html"><i class="fa  fa-book"></i> Hello World</a>
            
          
        
          
          
            <a class="list-group-item" href="/qm/c33edf33.html"><i class="fa  fa-book"></i> AspNet开发1</a>
            
          
        
          
          
            <a class="list-group-item" href="/qm/8cfe4bab.html"><i class="fa  fa-book"></i> 深入浅出Windows应用开发(四)</a>
            
          
        
          
          
            <a class="list-group-item" href="/qm/50fedeca.html"><i class="fa  fa-book"></i> Windows通用应用程序开发(三)</a>
            
          
        
          
          
            <a class="list-group-item" href="/qm/5bdeb856.html"><i class="fa  fa-book"></i> 深入浅出Windows应用程序开发(二)</a>
            
          
        
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                        <li><a href="mailto:Drfengling@163.com"><i class="fa fa-envelope"></i></a></li>
                        <li><a target="_blank" rel="nofollow" href="https://t.me/CandyUnion"><i class="fa fa-telegram"></i></a></li>
                        
                        
                        
                        <li><a target="_blank" rel="me" href="https://nya.one/@Drfengling"><i class="fa fa fa-share-alt-square"></i></a></li>
                        <li><a target="_blank" rel="nofollow" href="https://github.com/Drfengling"><i class="fa fa-github"></i></a></li>
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2023 浅梦博客 版权所有.</li>
                            <li>本站已运行<span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by 浅梦风凌.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            <li><a href="https://beian.miit.gov.cn" rel="external nofollow" target="_blank">豫ICP备2022011311号</a></li>
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="https://unpkg.com/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
<script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>

  
<script src="/fancybox/jquery.fancybox.min.js"></script>



    <div>
        <canvas id="snow"></canvas>
        <script async type="text/javascript" src="/js/snow.min.js"></script>
    </div>



<script defer src="https://unpkg.com/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>

</html>